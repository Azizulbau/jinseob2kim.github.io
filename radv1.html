<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />



<meta name="date" content="2018-03-13" />

<title>Advanced R (1): Fast R &amp; Table 만들기</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-114370844-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="styles.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>
<script>
$(document).ready(function () {
  window.initializeCodeFolding("show" === "show");
});
</script>




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Jinseob's Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Statistics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="probability_likelihood.html">Likelihood</a>
    </li>
    <li>
      <a href="Normal_distribution.html">Normal Distribution</a>
    </li>
    <li>
      <a href="WAR.html">야구에서의 통계학: WAR</a>
    </li>
    <li>
      <a href="hypothesis.html">가설검정의 심리학</a>
    </li>
    <li>
      <a href="health_metrics.html">건강지표: DALY, QALY</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Mathematics
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="godel.html">괴델의 불완전성 정리</a>
    </li>
    <li>
      <a href="propose.html">조건부 확률로 알아보는 프로포즈 전략</a>
    </li>
    <li>
      <a href="eq5.html">5차방정식은 근의 공식이 없다</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    ML
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="deep_learning.html">딥러닝의 역사</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R Lecture
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="rbasic.html">R을 이용한 데이터 매니지먼트 기초</a>
    </li>
    <li>
      <a href="rbasic_plan_smc.html">R 의학통계 강의계획: 삼성서울병원</a>
    </li>
    <li>
      <a href="r_smc_1.html">R 의학통계: 삼성서울병원(1)- 기초 문법 및 Table 1</a>
    </li>
    <li>
      <a href="gam_korea.html">GAM: 고려대학교 의과대학</a>
    </li>
    <li>
      <a href="PopGene.html">Population Genetics Index: 유전체역학 2017</a>
    </li>
    <li>
      <a href="2018-02-09-리눅스-서버와-깃허브-github-쉽게-사용하기.html">리눅스 서버와 깃허브(github) 쉽게 사용하기</a>
    </li>
    <li>
      <a href="2018-02-09-gwas-visualization1.html">GWAS visualization (1): Summary table</a>
    </li>
    <li>
      <a href="2018-02-09-gwas-visualization2.html">GWAS visualization (2): Interactive plot</a>
    </li>
    <li>
      <a href="2018-02-09-gwas-visualization3.html">GWAS visualization (3): Automation</a>
    </li>
    <li>
      <a href="radv1.html">Advanced R (1): Fast R &amp; Table 만들기</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/jinseob2kim/jinseob2kim.github.io">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<style>
   p {line-height: 2.5em;}
</style>

<div class="fluid-row" id="header">

<div class="btn-group pull-right">
<button type="button" class="btn btn-default btn-xs dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Advanced R (1): Fast R &amp; Table 만들기</h1>
<h4 class="date"><em>2018-03-13</em></h4>

</div>


<p>본 자료는 아래의 내용들을 다룬다.</p>
<ol style="list-style-type: decimal">
<li><p><strong>data.table</strong> 패키지 소개</p></li>
<li><p>반복문 비교: <code>for</code> loop, <code>apply</code>문 (<code>lapply</code>, <code>mapply</code>), 멀티코어 이용(<strong>parallel</strong> 패키지의 <code>mclapply</code>, <code>mcmapply</code>)</p></li>
<li><p>Table 1 만들기: <strong>tableone</strong> 패키지</p></li>
<li><p>Regression result 정리하기: <strong>epiDisplay</strong> 패키지</p></li>
</ol>
<div id="data.table" class="section level1">
<h1>data.table</h1>
<p><strong>data.table</strong> 패키지는 data step을 빠르고 쉽게 수행하기 위한 패키지로 가장 인기많은 <strong>R</strong>패키지 중 하나이다. (<a href="https://www.rdocumentation.org/trends?page1=1&amp;sort1=direct&amp;page2=1&amp;sort2=total&amp;page3=1&amp;page4=1" class="uri">https://www.rdocumentation.org/trends?page1=1&amp;sort1=direct&amp;page2=1&amp;sort2=total&amp;page3=1&amp;page4=1</a>)</p>
<ul>
<li>장점: 매우 빠르다. (<strong>base</strong>, <strong>dplyr</strong> 대비)</li>
</ul>
<div class="figure">
<img src="http://csgillespie.github.io/efficientR/_main_files/figure-html/dtplot-1.png" alt="https://csgillespie.github.io/efficientR/data-processing-with-data-table.html" />
<p class="caption"><a href="https://csgillespie.github.io/efficientR/data-processing-with-data-table.html" class="uri">https://csgillespie.github.io/efficientR/data-processing-with-data-table.html</a></p>
</div>
<ul>
<li>단점: 문법이 헷갈린다. (<strong>dplyr</strong>가 가장 직관적임)</li>
</ul>
<div id="load-save-data-fread-fwrite" class="section level2 tabset">
<h2>Load &amp; save data: <code>fread</code> &amp; <code>fwrite</code></h2>
<p><code>fread</code> 함수로 구분자 (comma, tab, …)에 상관없이 빠르게 데이터를 읽을 수 있으며, <code>fwrtie</code>함수로 그것을 빠르게 파일로 저장할 수 있다. GWAS result 파일을 읽고 쓰는 것을 예로 들겠다. <code>fread</code>로 파일을 읽으면 그 class는 <code>data.frame</code>에 <code>data.table</code>이 추가되며 문법이 원래의 <code>data.frame</code>과 달라지는 점을 유의하자. 만약 데이터를 빨리 읽는 것만 활용하겠다면 <code>fread</code>를 활용해서 읽은 후 다시 원래의 <code>data.frame</code>형태로 바꿔 사용하면 된다.</p>
<div id="code" class="section level3">
<h3>Code</h3>
<pre class="r"><code>library(rbenchmark);library(knitr)
#install.packages(&quot;data.table&quot;)
library(data.table)</code></pre>
<pre class="r"><code>## Load file
setwd(&quot;/home/secondmath/Dropbox/example&quot;)
df = read.table(&quot;LinearTG.assoc.linear&quot;,header=T)
dt = fread(&quot;LinearTG.assoc.linear&quot;,header=T)

## Class
class(df)</code></pre>
<pre><code>## [1] &quot;data.frame&quot;</code></pre>
<pre class="r"><code>class(dt)</code></pre>
<pre><code>## [1] &quot;data.table&quot; &quot;data.frame&quot;</code></pre>
<pre class="r"><code>#dt = data.table(df)
#df = data.frame(dt)

## See 
dt</code></pre>
<pre><code>##         CHR        SNP       BP A1 TEST NMISS    BETA    STAT         P
##      1:   1 rs12565286   721290  C  ADD  1735 -12.760 -0.7056 4.805e-01
##      2:   1 rs12565286   721290  C  sex  1735 -16.150 -2.5230 1.174e-02
##      3:   1 rs12565286   721290  C  age  1735  -2.942 -6.0530 1.740e-09
##      4:   1  rs3094315   752566  G  ADD  1787   6.444  1.0340 3.012e-01
##      5:   1  rs3094315   752566  G  sex  1787 -16.210 -2.5840 9.851e-03
##     ---                                                                
## 417071:  22  rs2238837 51212875  C  sex  1787 -16.240 -2.5890 9.702e-03
## 417072:  22  rs2238837 51212875  C  age  1787  -3.021 -6.3360 2.973e-10
## 417073:  22 rs28729663 51219006  A  ADD  1787   1.031  0.1677 8.668e-01
## 417074:  22 rs28729663 51219006  A  sex  1787 -16.250 -2.5880 9.722e-03
## 417075:  22 rs28729663 51219006  A  age  1787  -3.030 -6.3500 2.718e-10</code></pre>
<pre class="r"><code>## Save file
write.csv(dt, &quot;aa.csv&quot;,row.names=F)
fwrite(dt, &quot;aa.csv&quot;)</code></pre>
</div>
<div id="benchmark" class="section level3">
<h3>Benchmark</h3>
<pre class="r"><code>setwd(&quot;/home/secondmath/Dropbox/example&quot;)

## Load
kable(
  benchmark(
    df = read.table(&quot;LinearTG.assoc.linear&quot;,header=T),
    dt = fread(&quot;LinearTG.assoc.linear&quot;,header=T), replications =1
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">df</td>
<td align="right">1</td>
<td align="right">3.668</td>
<td align="right">11.115</td>
<td align="right">3.664</td>
<td align="right">0.004</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">dt</td>
<td align="right">1</td>
<td align="right">0.330</td>
<td align="right">1.000</td>
<td align="right">0.331</td>
<td align="right">0.000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>## Save
kable(
  benchmark(
    writecsv = write.csv(dt, &quot;aa.csv&quot;,row.names=F),
    fwrite = fwrite(dt, &quot;aa.csv&quot;), replications =1
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td align="left">fwrite</td>
<td align="right">1</td>
<td align="right">0.078</td>
<td align="right">1.000</td>
<td align="right">0.412</td>
<td align="right">0.023</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>1</td>
<td align="left">writecsv</td>
<td align="right">1</td>
<td align="right">2.831</td>
<td align="right">36.295</td>
<td align="right">2.788</td>
<td align="right">0.044</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="row-opreation" class="section level2 tabset">
<h2>Row opreation</h2>
<p><strong>data.table</strong> 의 기본 문법은 <strong>DT[i, j, by]</strong> 형태이다. <a href="https://s3.amazonaws.com/assets.datacamp.com/blog_assets/datatable_Cheat_Sheet_R.pdf" class="uri">https://s3.amazonaws.com/assets.datacamp.com/blog_assets/datatable_Cheat_Sheet_R.pdf</a> 의 cheetsheet를 참고하면 좋다.</p>
<div class="figure">
<img src="http://2.bp.blogspot.com/-L-DIRIa6pi4/WAdcNIhzCfI/AAAAAAAAFiE/RN9-bFU6rZAIfZpAbY9v8pLFRpoTHbQxACLcB/s1600/Data%2BTable%2BSyntax.png" alt="data.table 문법" />
<p class="caption">data.table 문법</p>
</div>
<div id="code-1" class="section level3">
<h3>Code</h3>
<pre class="r"><code>dt[TEST== &quot;ADD&quot;]</code></pre>
<pre><code>##         CHR        SNP       BP A1 TEST NMISS    BETA    STAT      P
##      1:   1 rs12565286   721290  C  ADD  1735 -12.760 -0.7056 0.4805
##      2:   1  rs3094315   752566  G  ADD  1787   6.444  1.0340 0.3012
##      3:   1 rs11240777   798959  A  ADD  1787  -2.710 -0.6138 0.5394
##      4:   1  rs3748597   888659  T  ADD  1787  11.550  1.2200 0.2228
##      5:   1  rs2341354   918573  A  ADD  1787  -3.398 -0.5769 0.5641
##     ---                                                             
## 139021:  22  rs9628187 51156666  T  ADD  1787  23.430  1.2820 0.1999
## 139022:  22   rs715586 51163138  T  ADD  1787   2.206  0.2466 0.8053
## 139023:  22  rs3810648 51175626  G  ADD  1787  -8.414 -0.5470 0.5845
## 139024:  22  rs2238837 51212875  C  ADD  1787   7.657  1.6130 0.1070
## 139025:  22 rs28729663 51219006  A  ADD  1787   1.031  0.1677 0.8668</code></pre>
<pre class="r"><code>#dt[TEST== &quot;ADD&quot;, ] ## same
kable(
  dt[(TEST== &quot;ADD&quot;) &amp; (P&lt;= 5e-8)]
  )</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">CHR</th>
<th align="left">SNP</th>
<th align="right">BP</th>
<th align="left">A1</th>
<th align="left">TEST</th>
<th align="right">NMISS</th>
<th align="right">BETA</th>
<th align="right">STAT</th>
<th align="right">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs1974718</td>
<td align="right">116606766</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1743</td>
<td align="right">29.44</td>
<td align="right">5.659</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs1558860</td>
<td align="right">116607368</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1743</td>
<td align="right">29.44</td>
<td align="right">5.659</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs1558861</td>
<td align="right">116607437</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1758</td>
<td align="right">29.30</td>
<td align="right">5.665</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs9326246</td>
<td align="right">116611733</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1774</td>
<td align="right">29.58</td>
<td align="right">5.742</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs180349</td>
<td align="right">116611827</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1774</td>
<td align="right">29.30</td>
<td align="right">5.694</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs6589564</td>
<td align="right">116624153</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1736</td>
<td align="right">29.56</td>
<td align="right">5.657</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs180326</td>
<td align="right">116624703</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1758</td>
<td align="right">30.13</td>
<td align="right">5.784</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs7930786</td>
<td align="right">116624727</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1758</td>
<td align="right">30.42</td>
<td align="right">5.832</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs3825041</td>
<td align="right">116631707</td>
<td align="left">T</td>
<td align="left">ADD</td>
<td align="right">1753</td>
<td align="right">30.66</td>
<td align="right">5.868</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs10790162</td>
<td align="right">116639104</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1773</td>
<td align="right">31.38</td>
<td align="right">6.054</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs6589565</td>
<td align="right">116640237</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1773</td>
<td align="right">31.38</td>
<td align="right">6.054</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs2160669</td>
<td align="right">116647607</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1779</td>
<td align="right">30.79</td>
<td align="right">5.981</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs964184</td>
<td align="right">116648917</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1779</td>
<td align="right">30.79</td>
<td align="right">5.981</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs6589566</td>
<td align="right">116652423</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">30.92</td>
<td align="right">6.023</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs7483863</td>
<td align="right">116652491</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1782</td>
<td align="right">30.97</td>
<td align="right">6.022</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs2075290</td>
<td align="right">116653296</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1710</td>
<td align="right">30.64</td>
<td align="right">5.833</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs10750096</td>
<td align="right">116656788</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1777</td>
<td align="right">31.30</td>
<td align="right">6.074</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs2266788</td>
<td align="right">116660686</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1777</td>
<td align="right">30.72</td>
<td align="right">5.972</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs2072560</td>
<td align="right">116661826</td>
<td align="left">T</td>
<td align="left">ADD</td>
<td align="right">1735</td>
<td align="right">30.67</td>
<td align="right">5.842</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs7123666</td>
<td align="right">116667083</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1753</td>
<td align="right">35.18</td>
<td align="right">5.688</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>res = dt[TEST== &quot;ADD&quot;]
res.df = df[df$TEST== &quot;ADD&quot;,]

kable(
  res[(CHR %in% 1:11) &amp; (P &lt;= 5e-8)]
  )</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">CHR</th>
<th align="left">SNP</th>
<th align="right">BP</th>
<th align="left">A1</th>
<th align="left">TEST</th>
<th align="right">NMISS</th>
<th align="right">BETA</th>
<th align="right">STAT</th>
<th align="right">P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs1974718</td>
<td align="right">116606766</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1743</td>
<td align="right">29.44</td>
<td align="right">5.659</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs1558860</td>
<td align="right">116607368</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1743</td>
<td align="right">29.44</td>
<td align="right">5.659</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs1558861</td>
<td align="right">116607437</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1758</td>
<td align="right">29.30</td>
<td align="right">5.665</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs9326246</td>
<td align="right">116611733</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1774</td>
<td align="right">29.58</td>
<td align="right">5.742</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs180349</td>
<td align="right">116611827</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1774</td>
<td align="right">29.30</td>
<td align="right">5.694</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs6589564</td>
<td align="right">116624153</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1736</td>
<td align="right">29.56</td>
<td align="right">5.657</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs180326</td>
<td align="right">116624703</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1758</td>
<td align="right">30.13</td>
<td align="right">5.784</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs7930786</td>
<td align="right">116624727</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1758</td>
<td align="right">30.42</td>
<td align="right">5.832</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs3825041</td>
<td align="right">116631707</td>
<td align="left">T</td>
<td align="left">ADD</td>
<td align="right">1753</td>
<td align="right">30.66</td>
<td align="right">5.868</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs10790162</td>
<td align="right">116639104</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1773</td>
<td align="right">31.38</td>
<td align="right">6.054</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs6589565</td>
<td align="right">116640237</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1773</td>
<td align="right">31.38</td>
<td align="right">6.054</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs2160669</td>
<td align="right">116647607</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1779</td>
<td align="right">30.79</td>
<td align="right">5.981</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs964184</td>
<td align="right">116648917</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1779</td>
<td align="right">30.79</td>
<td align="right">5.981</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs6589566</td>
<td align="right">116652423</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">30.92</td>
<td align="right">6.023</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs7483863</td>
<td align="right">116652491</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1782</td>
<td align="right">30.97</td>
<td align="right">6.022</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs2075290</td>
<td align="right">116653296</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1710</td>
<td align="right">30.64</td>
<td align="right">5.833</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs10750096</td>
<td align="right">116656788</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1777</td>
<td align="right">31.30</td>
<td align="right">6.074</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs2266788</td>
<td align="right">116660686</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1777</td>
<td align="right">30.72</td>
<td align="right">5.972</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">11</td>
<td align="left">rs2072560</td>
<td align="right">116661826</td>
<td align="left">T</td>
<td align="left">ADD</td>
<td align="right">1735</td>
<td align="right">30.67</td>
<td align="right">5.842</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">11</td>
<td align="left">rs7123666</td>
<td align="right">116667083</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1753</td>
<td align="right">35.18</td>
<td align="right">5.688</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>미리 <code>key</code>들을 지정하면 그것들에 대해 더 빠르게 검색할 수 있다.</p>
<pre class="r"><code># 1 key
setkey(dt, TEST)
dt[&quot;ADD&quot;]</code></pre>
<pre><code>##         CHR        SNP       BP A1 TEST NMISS    BETA    STAT      P
##      1:   1 rs12565286   721290  C  ADD  1735 -12.760 -0.7056 0.4805
##      2:   1  rs3094315   752566  G  ADD  1787   6.444  1.0340 0.3012
##      3:   1 rs11240777   798959  A  ADD  1787  -2.710 -0.6138 0.5394
##      4:   1  rs3748597   888659  T  ADD  1787  11.550  1.2200 0.2228
##      5:   1  rs2341354   918573  A  ADD  1787  -3.398 -0.5769 0.5641
##     ---                                                             
## 139021:  22  rs9628187 51156666  T  ADD  1787  23.430  1.2820 0.1999
## 139022:  22   rs715586 51163138  T  ADD  1787   2.206  0.2466 0.8053
## 139023:  22  rs3810648 51175626  G  ADD  1787  -8.414 -0.5470 0.5845
## 139024:  22  rs2238837 51212875  C  ADD  1787   7.657  1.6130 0.1070
## 139025:  22 rs28729663 51219006  A  ADD  1787   1.031  0.1677 0.8668</code></pre>
<pre class="r"><code>## 2 keys
setkey(dt, TEST, CHR)
dt[ .(&quot;ADD&quot;, 11)]        </code></pre>
<pre><code>##        CHR        SNP        BP A1 TEST NMISS   BETA    STAT       P
##     1:  11  rs7930823    206767  A  ADD  1787 -3.401 -0.7011 0.48330
##     2:  11 rs11246002    211447  A  ADD  1787 -1.714 -0.2427 0.80830
##     3:  11  rs3825075    217140  C  ADD  1787  3.479  0.7614 0.44650
##     4:  11   rs536715    230368  T  ADD  1787 -2.431 -0.5473 0.58430
##     5:  11  rs4980329    232598  T  ADD  1787 13.300  2.0130 0.04429
##    ---                                                              
## 29754:  11  rs7929069 134932565  A  ADD  1787  7.046  1.1610 0.24570
## 29755:  11 rs10894957 134933513  C  ADD  1787  7.179  1.4890 0.13660
## 29756:  11 rs10894958 134933972  G  ADD  1787  8.607  1.4150 0.15730
## 29757:  11 rs12294124 134934063  G  ADD  1787  8.363  1.3780 0.16820
## 29758:  11  rs4430531 134942626  A  ADD  1787 -2.207 -0.4704 0.63810</code></pre>
<pre class="r"><code>dt[ .(&quot;ADD&quot;, 1:11)]</code></pre>
<pre><code>##         CHR        SNP        BP A1 TEST NMISS    BETA    STAT      P
##      1:   1 rs12565286    721290  C  ADD  1735 -12.760 -0.7056 0.4805
##      2:   1  rs3094315    752566  G  ADD  1787   6.444  1.0340 0.3012
##      3:   1 rs11240777    798959  A  ADD  1787  -2.710 -0.6138 0.5394
##      4:   1  rs3748597    888659  T  ADD  1787  11.550  1.2200 0.2228
##      5:   1  rs2341354    918573  A  ADD  1787  -3.398 -0.5769 0.5641
##     ---                                                              
## 102255:  11  rs7929069 134932565  A  ADD  1787   7.046  1.1610 0.2457
## 102256:  11 rs10894957 134933513  C  ADD  1787   7.179  1.4890 0.1366
## 102257:  11 rs10894958 134933972  G  ADD  1787   8.607  1.4150 0.1573
## 102258:  11 rs12294124 134934063  G  ADD  1787   8.363  1.3780 0.1682
## 102259:  11  rs4430531 134942626  A  ADD  1787  -2.207 -0.4704 0.6381</code></pre>
</div>
<div id="benchmark-1" class="section level3">
<h3>benchmark</h3>
<pre class="r"><code>kable(
  benchmark(
  res.df = df[df$TEST==&quot;ADD&quot;,],
  res = dt[TEST==&quot;ADD&quot;], 
  res.key = dt[&quot;ADD&quot;], replications=10
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td align="left">res</td>
<td align="right">10</td>
<td align="right">0.109</td>
<td align="right">1.198</td>
<td align="right">0.104</td>
<td align="right">0.004</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>1</td>
<td align="left">res.df</td>
<td align="right">10</td>
<td align="right">0.270</td>
<td align="right">2.967</td>
<td align="right">0.270</td>
<td align="right">0.000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>3</td>
<td align="left">res.key</td>
<td align="right">10</td>
<td align="right">0.091</td>
<td align="right">1.000</td>
<td align="right">0.091</td>
<td align="right">0.000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="column-opereation" class="section level2 tabset">
<h2>Column opereation</h2>
<p>열을 선택하는 방법도 기존의 <code>data.frame</code>과 비슷하나 몇 가지 차이점이 있다.</p>
<div id="code-2" class="section level3">
<h3>Code</h3>
<pre class="r"><code>res[, &quot;SNP&quot;]  ## data.table class</code></pre>
<pre><code>##                SNP
##      1: rs12565286
##      2:  rs3094315
##      3: rs11240777
##      4:  rs3748597
##      5:  rs2341354
##     ---           
## 139021:  rs9628187
## 139022:   rs715586
## 139023:  rs3810648
## 139024:  rs2238837
## 139025: rs28729663</code></pre>
<pre class="r"><code>res[, .(SNP)] ## same</code></pre>
<pre><code>##                SNP
##      1: rs12565286
##      2:  rs3094315
##      3: rs11240777
##      4:  rs3748597
##      5:  rs2341354
##     ---           
## 139021:  rs9628187
## 139022:   rs715586
## 139023:  rs3810648
## 139024:  rs2238837
## 139025: rs28729663</code></pre>
<pre class="r"><code>res[, SNP] ## vector</code></pre>
<pre class="r"><code>res[, c(&quot;SNP&quot;,&quot;P&quot;)]</code></pre>
<pre><code>##                SNP      P
##      1: rs12565286 0.4805
##      2:  rs3094315 0.3012
##      3: rs11240777 0.5394
##      4:  rs3748597 0.2228
##      5:  rs2341354 0.5641
##     ---                  
## 139021:  rs9628187 0.1999
## 139022:   rs715586 0.8053
## 139023:  rs3810648 0.5845
## 139024:  rs2238837 0.1070
## 139025: rs28729663 0.8668</code></pre>
<pre class="r"><code>res[, .(SNP, P)]</code></pre>
<pre><code>##                SNP      P
##      1: rs12565286 0.4805
##      2:  rs3094315 0.3012
##      3: rs11240777 0.5394
##      4:  rs3748597 0.2228
##      5:  rs2341354 0.5641
##     ---                  
## 139021:  rs9628187 0.1999
## 139022:   rs715586 0.8053
## 139023:  rs3810648 0.5845
## 139024:  rs2238837 0.1070
## 139025: rs28729663 0.8668</code></pre>
<pre class="r"><code>res[, c(3, 9)]</code></pre>
<pre><code>##               BP      P
##      1:   721290 0.4805
##      2:   752566 0.3012
##      3:   798959 0.5394
##      4:   888659 0.2228
##      5:   918573 0.5641
##     ---                
## 139021: 51156666 0.1999
## 139022: 51163138 0.8053
## 139023: 51175626 0.5845
## 139024: 51212875 0.1070
## 139025: 51219006 0.8668</code></pre>
<p>주의!!</p>
<pre class="r"><code>vars= c(&quot;SNP&quot;,&quot;P&quot;)
vars = c(3,9)</code></pre>
<pre class="r"><code>res[, vars] # error</code></pre>
<pre><code>## Error in `[.data.table`(res, , vars): j (the 2nd argument inside [...]) is a single symbol but column name &#39;vars&#39; is not found. Perhaps you intended DT[,..vars] or DT[,vars,with=FALSE]. This difference to data.frame is deliberate and explained in FAQ 1.1.</code></pre>
<p><code>with = F</code> 를 뒤에 붙이거나 <code>.SD</code>, <code>.SDcols</code> 옵션을 사용하자.</p>
<pre class="r"><code>res[, vars, with=F]</code></pre>
<pre><code>##               BP      P
##      1:   721290 0.4805
##      2:   752566 0.3012
##      3:   798959 0.5394
##      4:   888659 0.2228
##      5:   918573 0.5641
##     ---                
## 139021: 51156666 0.1999
## 139022: 51163138 0.8053
## 139023: 51175626 0.5845
## 139024: 51212875 0.1070
## 139025: 51219006 0.8668</code></pre>
<pre class="r"><code>res[, .SD, .SDcols = vars]</code></pre>
<pre><code>##               BP      P
##      1:   721290 0.4805
##      2:   752566 0.3012
##      3:   798959 0.5394
##      4:   888659 0.2228
##      5:   918573 0.5641
##     ---                
## 139021: 51156666 0.1999
## 139022: 51163138 0.8053
## 139023: 51175626 0.5845
## 139024: 51212875 0.1070
## 139025: 51219006 0.8668</code></pre>
<p>변수 생성은 <code>:=</code> 를 이용한다.</p>
<pre class="r"><code>## Make 1 variable
res[, sigP:= as.numeric(P &lt;=5e-8)]

## Make multiple variables
res[, &quot;:=&quot; (sigP1= as.numeric(P &lt;=5e-8), sigP2= ifelse(P &lt;=5e-5, 1, 0))]</code></pre>
</div>
<div id="benchmark-2" class="section level3">
<h3>Benchmark</h3>
<pre class="r"><code>kable(
  benchmark(
  col.df = res.df$SNP,
  col.dt = dt[, &quot;SNP&quot;], replications=10 
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="left">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">col.df</td>
<td align="right">10</td>
<td align="right">0.000</td>
<td align="left">NA</td>
<td align="right">0.000</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">col.dt</td>
<td align="right">10</td>
<td align="right">0.012</td>
<td align="left">NA</td>
<td align="right">0.012</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="function" class="section level2 tabset">
<h2>Function</h2>
<p>이번에는 phenotype data를 예로 들겠다.</p>
<div id="code-3" class="section level3">
<h3>Code</h3>
<pre class="r"><code>ph = fread(&quot;/home/secondmath/Dropbox/myarticle/MOR_heri/prac.phe&quot;)
kable(
  tail(ph)
  )</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">FID</th>
<th align="left">ID</th>
<th align="right">sex</th>
<th align="right">age</th>
<th align="right">DXA_total_tscore</th>
<th align="right">FBS</th>
<th align="right">tCholesterol</th>
<th align="right">HDL</th>
<th align="right">LDL</th>
<th align="right">TG</th>
<th align="right">Height</th>
<th align="right">Weight</th>
<th align="right">SittingHt</th>
<th align="right">Waist</th>
<th align="right">Hip</th>
<th align="right">headcircum</th>
<th align="right">armspan</th>
<th align="right">BMI</th>
<th align="right">SBP</th>
<th align="right">DBP</th>
<th align="right">birth</th>
<th align="right">gweek</th>
<th align="right">MET</th>
<th align="right">total_kcal</th>
<th align="right">PY</th>
<th align="right">FTND</th>
<th align="right">smoke</th>
<th align="right">alcohol</th>
<th align="right">hyperTG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">R4F185PR</td>
<td align="left">R4E1I08231</td>
<td align="right">1</td>
<td align="right">55</td>
<td align="right">-2.6</td>
<td align="right">99</td>
<td align="right">232</td>
<td align="right">43</td>
<td align="right">160</td>
<td align="right">145</td>
<td align="right">155.0</td>
<td align="right">53.0</td>
<td align="right">87.5</td>
<td align="right">78.5</td>
<td align="right">96.3</td>
<td align="right">54.3</td>
<td align="right">155.0</td>
<td align="right">22.06</td>
<td align="right">140</td>
<td align="right">80</td>
<td align="right">510809</td>
<td align="right">NA</td>
<td align="right">3696</td>
<td align="right">2344.574</td>
<td align="right">0.0</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">R4F200PR</td>
<td align="left">R4E1I09631</td>
<td align="right">1</td>
<td align="right">59</td>
<td align="right">-3.8</td>
<td align="right">96</td>
<td align="right">236</td>
<td align="right">52</td>
<td align="right">149</td>
<td align="right">171</td>
<td align="right">149.5</td>
<td align="right">54.0</td>
<td align="right">83.6</td>
<td align="right">74.5</td>
<td align="right">93.4</td>
<td align="right">53.4</td>
<td align="right">142.5</td>
<td align="right">24.16</td>
<td align="right">166</td>
<td align="right">96</td>
<td align="right">471018</td>
<td align="right">11.75125</td>
<td align="right">5364</td>
<td align="right">2514.242</td>
<td align="right">0.0</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">R4F315PR</td>
<td align="left">R4E1I13271</td>
<td align="right">1</td>
<td align="right">50</td>
<td align="right">0.6</td>
<td align="right">106</td>
<td align="right">233</td>
<td align="right">50</td>
<td align="right">170</td>
<td align="right">95</td>
<td align="right">152.8</td>
<td align="right">61.4</td>
<td align="right">85.6</td>
<td align="right">88.2</td>
<td align="right">94.8</td>
<td align="right">52.8</td>
<td align="right">151.4</td>
<td align="right">26.29</td>
<td align="right">120</td>
<td align="right">80</td>
<td align="right">561205</td>
<td align="right">NA</td>
<td align="right">3072</td>
<td align="right">1779.503</td>
<td align="right">0.0</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">X1F330PR</td>
<td align="left">X1E1I13751</td>
<td align="right">1</td>
<td align="right">51</td>
<td align="right">-0.8</td>
<td align="right">85</td>
<td align="right">153</td>
<td align="right">46</td>
<td align="right">93</td>
<td align="right">79</td>
<td align="right">151.6</td>
<td align="right">54.4</td>
<td align="right">84.1</td>
<td align="right">77.1</td>
<td align="right">95.4</td>
<td align="right">54.4</td>
<td align="right">150.5</td>
<td align="right">23.67</td>
<td align="right">104</td>
<td align="right">68</td>
<td align="right">550901</td>
<td align="right">NA</td>
<td align="right">4468</td>
<td align="right">1729.046</td>
<td align="right">0.0</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">X1X330PR</td>
<td align="left">X1E1I13761</td>
<td align="right">1</td>
<td align="right">46</td>
<td align="right">-1.0</td>
<td align="right">89</td>
<td align="right">220</td>
<td align="right">62</td>
<td align="right">142</td>
<td align="right">70</td>
<td align="right">152.7</td>
<td align="right">45.2</td>
<td align="right">83.0</td>
<td align="right">66.9</td>
<td align="right">86.0</td>
<td align="right">52.5</td>
<td align="right">153.1</td>
<td align="right">19.38</td>
<td align="right">110</td>
<td align="right">64</td>
<td align="right">610708</td>
<td align="right">6.91250</td>
<td align="right">53892</td>
<td align="right">1089.507</td>
<td align="right">0.0</td>
<td align="right">NA</td>
<td align="right">1</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">X1F342PR</td>
<td align="left">X1E1I14140</td>
<td align="right">0</td>
<td align="right">34</td>
<td align="right">-1.2</td>
<td align="right">96</td>
<td align="right">199</td>
<td align="right">52</td>
<td align="right">133</td>
<td align="right">165</td>
<td align="right">169.5</td>
<td align="right">80.5</td>
<td align="right">92.1</td>
<td align="right">90.1</td>
<td align="right">101.0</td>
<td align="right">57.8</td>
<td align="right">168.8</td>
<td align="right">28.01</td>
<td align="right">111</td>
<td align="right">64</td>
<td align="right">721118</td>
<td align="right">NA</td>
<td align="right">807</td>
<td align="right">1863.503</td>
<td align="right">0.6</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">1</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>ph[, mean(LDL, na.rm=T)]</code></pre>
<pre><code>## [1] 110.3517</code></pre>
<pre class="r"><code>ph[, .(meanLDL= mean(LDL, na.rm=T), meanHDL= mean(HDL, na.rm=T))]</code></pre>
<pre><code>##     meanLDL  meanHDL
## 1: 110.3517 49.99562</code></pre>
<pre class="r"><code>kable(
  ph[, lapply(.SD, mean, na.rm=T), .SDcols= -c(1,2)]
  , digits=2
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">sex</th>
<th align="right">age</th>
<th align="right">DXA_total_tscore</th>
<th align="right">FBS</th>
<th align="right">tCholesterol</th>
<th align="right">HDL</th>
<th align="right">LDL</th>
<th align="right">TG</th>
<th align="right">Height</th>
<th align="right">Weight</th>
<th align="right">SittingHt</th>
<th align="right">Waist</th>
<th align="right">Hip</th>
<th align="right">headcircum</th>
<th align="right">armspan</th>
<th align="right">BMI</th>
<th align="right">SBP</th>
<th align="right">DBP</th>
<th align="right">birth</th>
<th align="right">gweek</th>
<th align="right">MET</th>
<th align="right">total_kcal</th>
<th align="right">PY</th>
<th align="right">FTND</th>
<th align="right">smoke</th>
<th align="right">alcohol</th>
<th align="right">hyperTG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0.57</td>
<td align="right">44.2</td>
<td align="right">-0.34</td>
<td align="right">93.6</td>
<td align="right">189.58</td>
<td align="right">50</td>
<td align="right">110.35</td>
<td align="right">114.95</td>
<td align="right">161.62</td>
<td align="right">62.05</td>
<td align="right">88.23</td>
<td align="right">80.49</td>
<td align="right">94.51</td>
<td align="right">55.36</td>
<td align="right">160.82</td>
<td align="right">23.65</td>
<td align="right">117.53</td>
<td align="right">74.25</td>
<td align="right">620639.4</td>
<td align="right">111.23</td>
<td align="right">6341.83</td>
<td align="right">2034.19</td>
<td align="right">5.53</td>
<td align="right">3.37</td>
<td align="right">1.57</td>
<td align="right">2.33</td>
<td align="right">0.12</td>
</tr>
</tbody>
</table>
</div>
<div id="benchmark-3" class="section level3">
<h3>Benchmark</h3>
<p>data.frame에 내장함수인 <code>colMeans</code>을 적용한 것이 가장 좋았다.</p>
<pre class="r"><code>ph.df = data.frame(ph)

kable(
  benchmark(
  mean.df = sapply(ph.df[,-c(1,2)], mean, na.rm=T),
  mean.dt = ph[, lapply(.SD, mean, na.rm=T), .SDcols= -c(1,2)], 
  colmean.df = colMeans(ph.df[, -c(1,2)], na.rm=T),  
  colmean.dt = colMeans(ph[, -c(1,2)], na.rm=T), replications = 10 
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td align="left">colmean.df</td>
<td align="right">10</td>
<td align="right">0.006</td>
<td align="right">1.000</td>
<td align="right">0.006</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>4</td>
<td align="left">colmean.dt</td>
<td align="right">10</td>
<td align="right">0.018</td>
<td align="right">3.000</td>
<td align="right">0.018</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>1</td>
<td align="left">mean.df</td>
<td align="right">10</td>
<td align="right">0.013</td>
<td align="right">2.167</td>
<td align="right">0.014</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>2</td>
<td align="left">mean.dt</td>
<td align="right">10</td>
<td align="right">0.029</td>
<td align="right">4.833</td>
<td align="right">0.029</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="by-operation" class="section level2 tabset">
<h2>By operation</h2>
<p><code>By</code> 옵션을 이용하여 그룹별로 함수를 적용할 수 있다.</p>
<div id="code-4" class="section level3">
<h3>Code</h3>
<pre class="r"><code>kable(
  ph[, lapply(.SD, mean, na.rm=T), .SDcols= -c(1,2), by= sex],
  caption = &quot;1 group&quot;, digits=2
)</code></pre>
<table>
<caption>1 group</caption>
<thead>
<tr class="header">
<th align="right">sex</th>
<th align="right">age</th>
<th align="right">DXA_total_tscore</th>
<th align="right">FBS</th>
<th align="right">tCholesterol</th>
<th align="right">HDL</th>
<th align="right">LDL</th>
<th align="right">TG</th>
<th align="right">Height</th>
<th align="right">Weight</th>
<th align="right">SittingHt</th>
<th align="right">Waist</th>
<th align="right">Hip</th>
<th align="right">headcircum</th>
<th align="right">armspan</th>
<th align="right">BMI</th>
<th align="right">SBP</th>
<th align="right">DBP</th>
<th align="right">birth</th>
<th align="right">gweek</th>
<th align="right">MET</th>
<th align="right">total_kcal</th>
<th align="right">PY</th>
<th align="right">FTND</th>
<th align="right">smoke</th>
<th align="right">alcohol</th>
<th align="right">hyperTG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">44.60</td>
<td align="right">-0.28</td>
<td align="right">97.12</td>
<td align="right">191.08</td>
<td align="right">46.45</td>
<td align="right">112.84</td>
<td align="right">140.34</td>
<td align="right">169.26</td>
<td align="right">70.10</td>
<td align="right">92.00</td>
<td align="right">84.63</td>
<td align="right">96.02</td>
<td align="right">56.70</td>
<td align="right">169.07</td>
<td align="right">24.40</td>
<td align="right">121.73</td>
<td align="right">76.74</td>
<td align="right">617077.5</td>
<td align="right">179.74</td>
<td align="right">7236.79</td>
<td align="right">2141.69</td>
<td align="right">13.98</td>
<td align="right">3.57</td>
<td align="right">2.20</td>
<td align="right">2.65</td>
<td align="right">0.19</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">43.95</td>
<td align="right">-0.37</td>
<td align="right">91.36</td>
<td align="right">188.63</td>
<td align="right">52.25</td>
<td align="right">108.77</td>
<td align="right">98.80</td>
<td align="right">156.76</td>
<td align="right">56.93</td>
<td align="right">85.83</td>
<td align="right">77.86</td>
<td align="right">93.55</td>
<td align="right">54.52</td>
<td align="right">155.58</td>
<td align="right">23.18</td>
<td align="right">114.85</td>
<td align="right">72.67</td>
<td align="right">622903.3</td>
<td align="right">48.79</td>
<td align="right">5788.15</td>
<td align="right">1966.40</td>
<td align="right">0.48</td>
<td align="right">2.40</td>
<td align="right">1.16</td>
<td align="right">2.13</td>
<td align="right">0.07</td>
</tr>
</tbody>
</table>
<pre class="r"><code>kable(
  ph[, lapply(.SD, mean, na.rm=T), .SDcols= -c(1,2), by= .(sex, smoke)],
  caption= &quot;2 groups&quot;, digits=2
)</code></pre>
<table>
<caption>2 groups</caption>
<thead>
<tr class="header">
<th align="right">sex</th>
<th align="right">smoke</th>
<th align="right">age</th>
<th align="right">DXA_total_tscore</th>
<th align="right">FBS</th>
<th align="right">tCholesterol</th>
<th align="right">HDL</th>
<th align="right">LDL</th>
<th align="right">TG</th>
<th align="right">Height</th>
<th align="right">Weight</th>
<th align="right">SittingHt</th>
<th align="right">Waist</th>
<th align="right">Hip</th>
<th align="right">headcircum</th>
<th align="right">armspan</th>
<th align="right">BMI</th>
<th align="right">SBP</th>
<th align="right">DBP</th>
<th align="right">birth</th>
<th align="right">gweek</th>
<th align="right">MET</th>
<th align="right">total_kcal</th>
<th align="right">PY</th>
<th align="right">FTND</th>
<th align="right">alcohol</th>
<th align="right">hyperTG</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">NA</td>
<td align="right">44.00</td>
<td align="right">-0.45</td>
<td align="right">91.00</td>
<td align="right">193.50</td>
<td align="right">43.00</td>
<td align="right">120.00</td>
<td align="right">71.00</td>
<td align="right">163.35</td>
<td align="right">63.05</td>
<td align="right">86.22</td>
<td align="right">82.67</td>
<td align="right">88.92</td>
<td align="right">55.08</td>
<td align="right">164.95</td>
<td align="right">23.33</td>
<td align="right">125.00</td>
<td align="right">84.00</td>
<td align="right">625505.0</td>
<td align="right">42.18</td>
<td align="right">4452.50</td>
<td align="right">3193.08</td>
<td align="right">10.00</td>
<td align="right">2.00</td>
<td align="right">3.00</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">NA</td>
<td align="right">50.83</td>
<td align="right">0.40</td>
<td align="right">84.17</td>
<td align="right">201.00</td>
<td align="right">50.67</td>
<td align="right">113.17</td>
<td align="right">89.00</td>
<td align="right">156.33</td>
<td align="right">61.38</td>
<td align="right">86.20</td>
<td align="right">83.80</td>
<td align="right">96.17</td>
<td align="right">55.92</td>
<td align="right">161.38</td>
<td align="right">25.19</td>
<td align="right">123.33</td>
<td align="right">80.00</td>
<td align="right">547135.2</td>
<td align="right">3.36</td>
<td align="right">4643.00</td>
<td align="right">1681.71</td>
<td align="right">NaN</td>
<td align="right">NaN</td>
<td align="right">2.00</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">1</td>
<td align="right">44.27</td>
<td align="right">-0.37</td>
<td align="right">91.30</td>
<td align="right">188.90</td>
<td align="right">51.89</td>
<td align="right">109.34</td>
<td align="right">99.00</td>
<td align="right">156.72</td>
<td align="right">57.06</td>
<td align="right">85.83</td>
<td align="right">77.96</td>
<td align="right">93.65</td>
<td align="right">54.53</td>
<td align="right">155.55</td>
<td align="right">23.24</td>
<td align="right">115.16</td>
<td align="right">72.86</td>
<td align="right">619799.3</td>
<td align="right">40.10</td>
<td align="right">5778.30</td>
<td align="right">1963.52</td>
<td align="right">0.00</td>
<td align="right">3.00</td>
<td align="right">2.09</td>
<td align="right">0.07</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">2</td>
<td align="right">40.25</td>
<td align="right">-0.46</td>
<td align="right">88.72</td>
<td align="right">188.79</td>
<td align="right">54.38</td>
<td align="right">107.08</td>
<td align="right">92.17</td>
<td align="right">157.79</td>
<td align="right">55.48</td>
<td align="right">86.28</td>
<td align="right">76.75</td>
<td align="right">93.15</td>
<td align="right">54.44</td>
<td align="right">156.23</td>
<td align="right">22.29</td>
<td align="right">108.68</td>
<td align="right">68.36</td>
<td align="right">658263.9</td>
<td align="right">41.95</td>
<td align="right">4100.78</td>
<td align="right">1862.11</td>
<td align="right">5.21</td>
<td align="right">1.72</td>
<td align="right">2.36</td>
<td align="right">0.09</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">44.67</td>
<td align="right">-0.19</td>
<td align="right">96.12</td>
<td align="right">185.91</td>
<td align="right">45.79</td>
<td align="right">111.38</td>
<td align="right">118.78</td>
<td align="right">169.22</td>
<td align="right">69.94</td>
<td align="right">91.73</td>
<td align="right">84.25</td>
<td align="right">96.12</td>
<td align="right">56.58</td>
<td align="right">169.13</td>
<td align="right">24.35</td>
<td align="right">122.17</td>
<td align="right">76.66</td>
<td align="right">616088.0</td>
<td align="right">105.47</td>
<td align="right">6409.90</td>
<td align="right">2143.65</td>
<td align="right">0.00</td>
<td align="right">NaN</td>
<td align="right">2.44</td>
<td align="right">0.11</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">2</td>
<td align="right">49.33</td>
<td align="right">-0.28</td>
<td align="right">99.46</td>
<td align="right">191.00</td>
<td align="right">46.54</td>
<td align="right">112.73</td>
<td align="right">136.02</td>
<td align="right">168.46</td>
<td align="right">69.87</td>
<td align="right">91.79</td>
<td align="right">85.40</td>
<td align="right">95.81</td>
<td align="right">56.84</td>
<td align="right">168.36</td>
<td align="right">24.53</td>
<td align="right">123.38</td>
<td align="right">77.72</td>
<td align="right">569582.4</td>
<td align="right">167.93</td>
<td align="right">7731.91</td>
<td align="right">2097.88</td>
<td align="right">19.09</td>
<td align="right">3.17</td>
<td align="right">2.60</td>
<td align="right">0.17</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">3</td>
<td align="right">41.79</td>
<td align="right">-0.33</td>
<td align="right">96.34</td>
<td align="right">194.03</td>
<td align="right">46.78</td>
<td align="right">113.70</td>
<td align="right">155.29</td>
<td align="right">169.78</td>
<td align="right">70.35</td>
<td align="right">92.31</td>
<td align="right">84.40</td>
<td align="right">96.12</td>
<td align="right">56.68</td>
<td align="right">169.47</td>
<td align="right">24.36</td>
<td align="right">120.49</td>
<td align="right">76.18</td>
<td align="right">645482.0</td>
<td align="right">219.85</td>
<td align="right">7460.72</td>
<td align="right">2164.20</td>
<td align="right">19.85</td>
<td align="right">3.79</td>
<td align="right">2.79</td>
<td align="right">0.25</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">3</td>
<td align="right">40.89</td>
<td align="right">-0.39</td>
<td align="right">93.86</td>
<td align="right">184.15</td>
<td align="right">56.25</td>
<td align="right">101.46</td>
<td align="right">99.79</td>
<td align="right">156.78</td>
<td align="right">55.59</td>
<td align="right">85.69</td>
<td align="right">76.79</td>
<td align="right">92.21</td>
<td align="right">54.31</td>
<td align="right">155.39</td>
<td align="right">22.55</td>
<td align="right">113.15</td>
<td align="right">71.78</td>
<td align="right">652766.5</td>
<td align="right">128.71</td>
<td align="right">6771.50</td>
<td align="right">2075.10</td>
<td align="right">7.06</td>
<td align="right">2.70</td>
<td align="right">2.67</td>
<td align="right">0.09</td>
</tr>
</tbody>
</table>
</div>
<div id="benchmark-4" class="section level3">
<h3>Benchmark</h3>
<p><code>R</code>의 기본 함수인 <code>aggregate</code>와 비교해보자.</p>
<pre class="r"><code>kable(
  benchmark(
  aggregate.df = aggregate(ph.df[,-c(1,2)], by= list(sex=ph.df$sex, smoke=ph.df$smoke), mean, na.rm=T), 
  by.dt = ph[, lapply(.SD, mean, na.rm=T), .SDcols= -c(1,2), by= .(sex, smoke)], replications = 10 
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">aggregate.df</td>
<td align="right">10</td>
<td align="right">0.092</td>
<td align="right">1.000</td>
<td align="right">0.093</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">by.dt</td>
<td align="right">10</td>
<td align="right">0.434</td>
<td align="right">4.717</td>
<td align="right">2.681</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="merge" class="section level2 tabset">
<h2>Merge</h2>
<p><code>data.table</code>에서 <code>key</code>를 지정하면 빠르고 간단하게 merge를 수행할 수 있다. 자세한 내용은 <a href="https://rstudio-pubs-static.s3.amazonaws.com/52230_5ae0d25125b544caab32f75f0360e775.html" class="uri">https://rstudio-pubs-static.s3.amazonaws.com/52230_5ae0d25125b544caab32f75f0360e775.html</a> 를 참고하기 바란다.</p>
<div class="figure">
<img src="merge.png" alt="Merge in data.table" />
<p class="caption">Merge in data.table</p>
</div>
<p>두 GWAS 결과를 SNP에 따라 merge해 보자.</p>
<div id="code-5" class="section level3">
<h3>Code</h3>
<pre class="r"><code>## Set key
setkey(res, CHR,SNP,BP)

## Other GWAS result
res_logit = fread(&quot;/home/secondmath/Dropbox/example/LogisticTG.assoc.logistic&quot;)[TEST==&quot;ADD&quot;]
setkey(res_logit, CHR,SNP,BP)</code></pre>
<div class="figure">
<img src="radv1_fig/inner_join.jpg" />

</div>
<pre class="r"><code>kable(
  head(
    res[res_logit, nomatch=0]
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">CHR</th>
<th align="left">SNP</th>
<th align="right">BP</th>
<th align="left">A1</th>
<th align="left">TEST</th>
<th align="right">NMISS</th>
<th align="right">BETA</th>
<th align="right">STAT</th>
<th align="right">P</th>
<th align="right">sigP</th>
<th align="right">sigP1</th>
<th align="right">sigP2</th>
<th align="left">i.A1</th>
<th align="left">i.TEST</th>
<th align="right">i.NMISS</th>
<th align="right">OR</th>
<th align="right">i.STAT</th>
<th align="right">i.P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000085</td>
<td align="right">66857915</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.2200</td>
<td align="right">0.3273</td>
<td align="right">0.7434</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">1.1000</td>
<td align="right">0.57430</td>
<td align="right">0.56570</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000283</td>
<td align="right">209894661</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.8700</td>
<td align="right">0.5782</td>
<td align="right">0.5632</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.7977</td>
<td align="right">-1.88000</td>
<td align="right">0.06013</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000382</td>
<td align="right">175866321</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">5.7340</td>
<td align="right">1.2270</td>
<td align="right">0.2202</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9781</td>
<td align="right">-0.27550</td>
<td align="right">0.78290</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000528</td>
<td align="right">114471189</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-5.8730</td>
<td align="right">-0.9411</td>
<td align="right">0.3468</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9293</td>
<td align="right">-0.67490</td>
<td align="right">0.49970</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000997</td>
<td align="right">16125961</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-4.2490</td>
<td align="right">-0.9021</td>
<td align="right">0.3671</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9210</td>
<td align="right">-1.01200</td>
<td align="right">0.31160</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1001450</td>
<td align="right">39050786</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-0.9856</td>
<td align="right">-0.2140</td>
<td align="right">0.8306</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9976</td>
<td align="right">-0.03037</td>
<td align="right">0.97580</td>
</tr>
</tbody>
</table>
<div class="figure">
<img src="radv1_fig/left_join.jpg" />

</div>
<pre class="r"><code>## Left: res, Right: res_logit
kable(
  head(
    res_logit[res]
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">CHR</th>
<th align="left">SNP</th>
<th align="right">BP</th>
<th align="left">A1</th>
<th align="left">TEST</th>
<th align="right">NMISS</th>
<th align="right">OR</th>
<th align="right">STAT</th>
<th align="right">P</th>
<th align="left">i.A1</th>
<th align="left">i.TEST</th>
<th align="right">i.NMISS</th>
<th align="right">BETA</th>
<th align="right">i.STAT</th>
<th align="right">i.P</th>
<th align="right">sigP</th>
<th align="right">sigP1</th>
<th align="right">sigP2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000085</td>
<td align="right">66857915</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">1.1000</td>
<td align="right">0.57430</td>
<td align="right">0.56570</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.2200</td>
<td align="right">0.3273</td>
<td align="right">0.7434</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000283</td>
<td align="right">209894661</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.7977</td>
<td align="right">-1.88000</td>
<td align="right">0.06013</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.8700</td>
<td align="right">0.5782</td>
<td align="right">0.5632</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000382</td>
<td align="right">175866321</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9781</td>
<td align="right">-0.27550</td>
<td align="right">0.78290</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">5.7340</td>
<td align="right">1.2270</td>
<td align="right">0.2202</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000528</td>
<td align="right">114471189</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9293</td>
<td align="right">-0.67490</td>
<td align="right">0.49970</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-5.8730</td>
<td align="right">-0.9411</td>
<td align="right">0.3468</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000997</td>
<td align="right">16125961</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9210</td>
<td align="right">-1.01200</td>
<td align="right">0.31160</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-4.2490</td>
<td align="right">-0.9021</td>
<td align="right">0.3671</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1001450</td>
<td align="right">39050786</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9976</td>
<td align="right">-0.03037</td>
<td align="right">0.97580</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-0.9856</td>
<td align="right">-0.2140</td>
<td align="right">0.8306</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div class="figure">
<img src="radv1_fig/right_join.jpg" />

</div>
<pre class="r"><code>kable(
  head(
    res[res_logit]
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">CHR</th>
<th align="left">SNP</th>
<th align="right">BP</th>
<th align="left">A1</th>
<th align="left">TEST</th>
<th align="right">NMISS</th>
<th align="right">BETA</th>
<th align="right">STAT</th>
<th align="right">P</th>
<th align="right">sigP</th>
<th align="right">sigP1</th>
<th align="right">sigP2</th>
<th align="left">i.A1</th>
<th align="left">i.TEST</th>
<th align="right">i.NMISS</th>
<th align="right">OR</th>
<th align="right">i.STAT</th>
<th align="right">i.P</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000085</td>
<td align="right">66857915</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.2200</td>
<td align="right">0.3273</td>
<td align="right">0.7434</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">1.1000</td>
<td align="right">0.57430</td>
<td align="right">0.56570</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000283</td>
<td align="right">209894661</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.8700</td>
<td align="right">0.5782</td>
<td align="right">0.5632</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.7977</td>
<td align="right">-1.88000</td>
<td align="right">0.06013</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000382</td>
<td align="right">175866321</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">5.7340</td>
<td align="right">1.2270</td>
<td align="right">0.2202</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9781</td>
<td align="right">-0.27550</td>
<td align="right">0.78290</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000528</td>
<td align="right">114471189</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-5.8730</td>
<td align="right">-0.9411</td>
<td align="right">0.3468</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9293</td>
<td align="right">-0.67490</td>
<td align="right">0.49970</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000997</td>
<td align="right">16125961</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-4.2490</td>
<td align="right">-0.9021</td>
<td align="right">0.3671</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9210</td>
<td align="right">-1.01200</td>
<td align="right">0.31160</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1001450</td>
<td align="right">39050786</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-0.9856</td>
<td align="right">-0.2140</td>
<td align="right">0.8306</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9976</td>
<td align="right">-0.03037</td>
<td align="right">0.97580</td>
</tr>
</tbody>
</table>
<div class="figure">
<img src="radv1_fig/outer_join.jpg" />

</div>
<pre class="r"><code>kable(
  head(
   merge(res, res_logit, all=T)
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="right">CHR</th>
<th align="left">SNP</th>
<th align="right">BP</th>
<th align="left">A1.x</th>
<th align="left">TEST.x</th>
<th align="right">NMISS.x</th>
<th align="right">BETA</th>
<th align="right">STAT.x</th>
<th align="right">P.x</th>
<th align="right">sigP</th>
<th align="right">sigP1</th>
<th align="right">sigP2</th>
<th align="left">A1.y</th>
<th align="left">TEST.y</th>
<th align="right">NMISS.y</th>
<th align="right">OR</th>
<th align="right">STAT.y</th>
<th align="right">P.y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000085</td>
<td align="right">66857915</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.2200</td>
<td align="right">0.3273</td>
<td align="right">0.7434</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">1.1000</td>
<td align="right">0.57430</td>
<td align="right">0.56570</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000283</td>
<td align="right">209894661</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">3.8700</td>
<td align="right">0.5782</td>
<td align="right">0.5632</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">A</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.7977</td>
<td align="right">-1.88000</td>
<td align="right">0.06013</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000382</td>
<td align="right">175866321</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">5.7340</td>
<td align="right">1.2270</td>
<td align="right">0.2202</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9781</td>
<td align="right">-0.27550</td>
<td align="right">0.78290</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1000528</td>
<td align="right">114471189</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-5.8730</td>
<td align="right">-0.9411</td>
<td align="right">0.3468</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9293</td>
<td align="right">-0.67490</td>
<td align="right">0.49970</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="left">rs1000997</td>
<td align="right">16125961</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-4.2490</td>
<td align="right">-0.9021</td>
<td align="right">0.3671</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">G</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9210</td>
<td align="right">-1.01200</td>
<td align="right">0.31160</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="left">rs1001450</td>
<td align="right">39050786</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">-0.9856</td>
<td align="right">-0.2140</td>
<td align="right">0.8306</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">C</td>
<td align="left">ADD</td>
<td align="right">1787</td>
<td align="right">0.9976</td>
<td align="right">-0.03037</td>
<td align="right">0.97580</td>
</tr>
</tbody>
</table>
<div class="figure">
<img src="radv1_fig/cross_join.jpg" />

</div>
<pre class="r"><code>x = 1:100         ## 1~100
y = LETTERS       ## A~Z
z = letters       ## a~z

CJ(num= x, L= y, l= z)</code></pre>
<pre><code>##        num L l
##     1:   1 A a
##     2:   1 A b
##     3:   1 A c
##     4:   1 A d
##     5:   1 A e
##    ---        
## 67596: 100 Z v
## 67597: 100 Z w
## 67598: 100 Z x
## 67599: 100 Z y
## 67600: 100 Z z</code></pre>
</div>
<div id="rbindlist" class="section level3">
<h3>rbindlist</h3>
<p><code>rbindlist</code>함수를 사용하면 여러 개의 data를 빠르게 위아래로 합치면서 겹치지 않는 변수는 따로 분류할 수 있다.</p>
<pre class="r"><code>rbindlist(list(res,res_logit), fill=T)</code></pre>
<pre><code>##         CHR       SNP        BP A1 TEST NMISS   BETA    STAT      P sigP
##      1:   1 rs1000085  66857915  C  ADD  1787  3.220  0.3273 0.7434    0
##      2:   1 rs1000283 209894661  A  ADD  1787  3.870  0.5782 0.5632    0
##      3:   1 rs1000382 175866321  G  ADD  1787  5.734  1.2270 0.2202    0
##      4:   1 rs1000528 114471189  C  ADD  1787 -5.873 -0.9411 0.3468    0
##      5:   1 rs1000997  16125961  G  ADD  1787 -4.249 -0.9021 0.3671    0
##     ---                                                                 
## 278046:  22  rs986646  22398220  C  ADD  1787     NA -1.1270 0.2599   NA
## 278047:  22 rs9917559  37977305  A  ADD  1787     NA -1.0390 0.2988   NA
## 278048:  22 rs9941927  40209175  G  ADD  1787     NA -1.0640 0.2875   NA
## 278049:  22 rs9941935  22015144  G  ADD  1787     NA -0.7683 0.4423   NA
## 278050:  22  rs999224  27834500  G  ADD  1787     NA  0.6709 0.5023   NA
##         sigP1 sigP2     OR
##      1:     0     0     NA
##      2:     0     0     NA
##      3:     0     0     NA
##      4:     0     0     NA
##      5:     0     0     NA
##     ---                   
## 278046:    NA    NA 0.8858
## 278047:    NA    NA 0.8992
## 278048:    NA    NA 0.8237
## 278049:    NA    NA 0.8293
## 278050:    NA    NA 1.0540</code></pre>
<pre class="r"><code>#rbind(res,res_logit, fill=T)</code></pre>
</div>
<div id="benchmark-5" class="section level3">
<h3>Benchmark</h3>
<p>Inner join을 비교해보겠다.</p>
<pre class="r"><code>res_logit.df = data.frame(res_logit)
kable(
  benchmark(
  inner.df = merge(res.df, res_logit.df, by=c(&quot;SNP&quot;,&quot;CHR&quot;,&quot;BP&quot;), all = F), 
  inner.dt = res[res_logit], replications = 1 
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">inner.df</td>
<td align="right">1</td>
<td align="right">1.929</td>
<td align="right">83.87</td>
<td align="right">1.917</td>
<td align="right">0.012</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">inner.dt</td>
<td align="right">1</td>
<td align="right">0.023</td>
<td align="right">1.00</td>
<td align="right">0.023</td>
<td align="right">0.000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>Cross join을 비교해보겠다.</p>
<pre class="r"><code>kable(
  benchmark(
  expand.grid.df = expand.grid(num= x, L= y, l= z), 
  cj.dt = CJ(num= x, L= y, l= z), replications = 10 
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td align="left">cj.dt</td>
<td align="right">10</td>
<td align="right">0.009</td>
<td align="right">1.000</td>
<td align="right">0.009</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>1</td>
<td align="left">expand.grid.df</td>
<td align="right">10</td>
<td align="right">0.071</td>
<td align="right">7.889</td>
<td align="right">0.072</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="foverlaps-fast-overlap-joins" class="section level2">
<h2>foverlaps: Fast overlap joins</h2>
<p><strong>data.table</strong> 패키지의 <code>foverlaps</code>함수를 이용해서</p>
<ol style="list-style-type: decimal">
<li><p>Large data with small interval: ex) GWAS 결과</p></li>
<li><p>Small data with large interval: ex) GENE 정보</p></li>
</ol>
<p>를 합칠 수 있다. 일반적인 정보는 <a href="https://rdrr.io/cran/data.table/man/foverlaps.html" class="uri">https://rdrr.io/cran/data.table/man/foverlaps.html</a> 를 참고하기 바란다.</p>
<pre class="r"><code>## Gene info
glist_hg18 = fread(&quot;/home/secondmath/Dropbox/example/glist-hg18&quot;)
names(glist_hg18) = c(&quot;chr&quot;,&quot;start&quot;,&quot;end&quot;,&quot;gene&quot;)
setkey(glist_hg18, chr, start, end)   ## Set keys

kable(
  head(
    glist_hg18
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">chr</th>
<th align="right">start</th>
<th align="right">end</th>
<th align="left">gene</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="right">58953</td>
<td align="right">59871</td>
<td align="left">OR4F5</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">357521</td>
<td align="right">358460</td>
<td align="left">OR4F16</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">357521</td>
<td align="right">358460</td>
<td align="left">OR4F29</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">357521</td>
<td align="right">358460</td>
<td align="left">OR4F3</td>
</tr>
<tr class="odd">
<td align="left">1</td>
<td align="right">610958</td>
<td align="right">611897</td>
<td align="left">OR4F16</td>
</tr>
<tr class="even">
<td align="left">1</td>
<td align="right">610958</td>
<td align="right">611897</td>
<td align="left">OR4F29</td>
</tr>
</tbody>
</table>
<pre class="r"><code>## GWAS result: make new variable for foverlaps - chr, start, end 
res[, &quot;:=&quot; (chr=as.character(CHR), start=BP, end=BP)]   ## :=  -make variables 

## Run 
addgene = foverlaps(res, glist_hg18, by.x=c(&quot;chr&quot;,&quot;start&quot;,&quot;end&quot;), type=&quot;within&quot;, mult=&quot;first&quot;)

## See
kable(
  head(
    addgene
  ), 
  align=&quot;c&quot;
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="center">chr</th>
<th align="center">start</th>
<th align="center">end</th>
<th align="center">gene</th>
<th align="center">CHR</th>
<th align="center">SNP</th>
<th align="center">BP</th>
<th align="center">A1</th>
<th align="center">TEST</th>
<th align="center">NMISS</th>
<th align="center">BETA</th>
<th align="center">STAT</th>
<th align="center">P</th>
<th align="center">sigP</th>
<th align="center">sigP1</th>
<th align="center">sigP2</th>
<th align="center">i.start</th>
<th align="center">i.end</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">1</td>
<td align="center">66772412</td>
<td align="center">66983356</td>
<td align="center">SGIP1</td>
<td align="center">1</td>
<td align="center">rs1000085</td>
<td align="center">66857915</td>
<td align="center">C</td>
<td align="center">ADD</td>
<td align="center">1787</td>
<td align="center">3.2200</td>
<td align="center">0.3273</td>
<td align="center">0.7434</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">66857915</td>
<td align="center">66857915</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">1</td>
<td align="center">rs1000283</td>
<td align="center">209894661</td>
<td align="center">A</td>
<td align="center">ADD</td>
<td align="center">1787</td>
<td align="center">3.8700</td>
<td align="center">0.5782</td>
<td align="center">0.5632</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">209894661</td>
<td align="center">209894661</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">1</td>
<td align="center">rs1000382</td>
<td align="center">175866321</td>
<td align="center">G</td>
<td align="center">ADD</td>
<td align="center">1787</td>
<td align="center">5.7340</td>
<td align="center">1.2270</td>
<td align="center">0.2202</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">175866321</td>
<td align="center">175866321</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">114433436</td>
<td align="center">114497995</td>
<td align="center">SYT6</td>
<td align="center">1</td>
<td align="center">rs1000528</td>
<td align="center">114471189</td>
<td align="center">C</td>
<td align="center">ADD</td>
<td align="center">1787</td>
<td align="center">-5.8730</td>
<td align="center">-0.9411</td>
<td align="center">0.3468</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">114471189</td>
<td align="center">114471189</td>
</tr>
<tr class="odd">
<td align="center">1</td>
<td align="center">16046945</td>
<td align="center">16139537</td>
<td align="center">SPEN</td>
<td align="center">1</td>
<td align="center">rs1000997</td>
<td align="center">16125961</td>
<td align="center">G</td>
<td align="center">ADD</td>
<td align="center">1787</td>
<td align="center">-4.2490</td>
<td align="center">-0.9021</td>
<td align="center">0.3671</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">16125961</td>
<td align="center">16125961</td>
</tr>
<tr class="even">
<td align="center">1</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">NA</td>
<td align="center">1</td>
<td align="center">rs1001450</td>
<td align="center">39050786</td>
<td align="center">C</td>
<td align="center">ADD</td>
<td align="center">1787</td>
<td align="center">-0.9856</td>
<td align="center">-0.2140</td>
<td align="center">0.8306</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">0</td>
<td align="center">39050786</td>
<td align="center">39050786</td>
</tr>
</tbody>
</table>
</div>
<div id="reshape-data-wide-to-long-long-to-wide" class="section level2 tabset">
<h2>Reshape data: wide-to-long, long-to-wide</h2>
<p>마지막으로 data 형태를 바꾸는 <code>melt</code>(wide to long), <code>dcast</code>(long to wide) 를 알아보겠다. Phenotype data에서 lipid profile들을 한 column으로 합쳐보자.</p>
<div id="code-6" class="section level3">
<h3>Code</h3>
<pre class="r"><code>ph.long = melt(ph,
               measure.vars =  c(&quot;tCholesterol&quot;, &quot;HDL&quot;, &quot;LDL&quot;, &quot;TG&quot;), 
               id.vars = c(&quot;FID&quot;,&quot;ID&quot;,&quot;sex&quot;,&quot;age&quot;),
               variable.name = &quot;Lipid&quot;,
               value.name = &quot;value&quot;,
               na.rm =F
)

ph.long</code></pre>
<pre><code>##             FID         ID sex age        Lipid value
##     1: R1F001PR R1D1I00001   0  NA tCholesterol    NA
##     2: R1F001PR R1D1I00002   1  NA tCholesterol    NA
##     3: R1F002PR R1D1I00004   0  NA tCholesterol    NA
##     4: R1F006PR R1D1I00012   0  NA tCholesterol    NA
##     5: R1F007PR R1D1I00015   0  NA tCholesterol    NA
##    ---                                               
## 13840: R4F200PR R4E1I09631   1  59           TG   171
## 13841: R4F315PR R4E1I13271   1  50           TG    95
## 13842: X1F330PR X1E1I13751   1  51           TG    79
## 13843: X1X330PR X1E1I13761   1  46           TG    70
## 13844: X1F342PR X1E1I14140   0  34           TG   165</code></pre>
<p>이제 <code>dcast</code>함수를 이용해서 다시 lipid profile들을 다른 column으로 나눠보겠다.</p>
<pre class="r"><code>ph.wide = dcast(ph.long, 
                ID + FID + sex + age ~ Lipid, 
                value.var = &quot;value&quot;
)
                
ph.wide = dcast(ph.long, ... ~ Lipid, value.var = &quot;value&quot;)                           ## ... same
ph.wide</code></pre>
<pre><code>##            FID         ID sex age tCholesterol HDL LDL  TG
##    1: R1F001PR R1D1I00001   0  NA           NA  NA  NA  NA
##    2: R1F001PR R1D1I00002   1  NA           NA  NA  NA  NA
##    3: R1F001PR R1E1I00010   1  31          212  60 110 134
##    4: R1F001PR R1E1I00020   1  31          175  54  81 133
##    5: R1F002PR R1D1I00004   0  NA           NA  NA  NA  NA
##   ---                                                     
## 3457: X1018971 R1X1I18971   1  47          181  70  83  78
## 3458: X1019000 R1X1I19000   1  35          186  64  91  60
## 3459: X1F330PR X1E1I13751   1  51          153  46  93  79
## 3460: X1F342PR X1E1I14140   0  34          199  52 133 165
## 3461: X1X330PR X1E1I13761   1  46          220  62 142  70</code></pre>
</div>
<div id="benchmark-6" class="section level3">
<h3>Benchmark</h3>
<p><code>data.frame</code>에 <strong>reshape2</strong>패키지의 <code>melt</code>, <code>dcast</code>함수를 적용한 것과 비교해보겠다.</p>
<pre class="r"><code>kable(
  benchmark(
  melt.df = melt(ph.df, measure.vars =  c(&quot;tCholesterol&quot;, &quot;HDL&quot;, &quot;LDL&quot;, &quot;TG&quot;), id.vars = c(&quot;FID&quot;,&quot;ID&quot;,&quot;sex&quot;,&quot;age&quot;), variable.name = &quot;Lipid&quot;, value.name = &quot;value&quot;, na.rm =F), 
  melt.dt  = melt(ph, measure.vars =  c(&quot;tCholesterol&quot;, &quot;HDL&quot;, &quot;LDL&quot;, &quot;TG&quot;), id.vars = c(&quot;FID&quot;,&quot;ID&quot;,&quot;sex&quot;,&quot;age&quot;), variable.name = &quot;Lipid&quot;, value.name = &quot;value&quot;, na.rm =F), 
  replications = 10 
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">melt.df</td>
<td align="right">10</td>
<td align="right">0.044</td>
<td align="right">22</td>
<td align="right">0.043</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">melt.dt</td>
<td align="right">10</td>
<td align="right">0.002</td>
<td align="right">1</td>
<td align="right">0.003</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<pre class="r"><code>melt.df = melt(ph.df, measure.vars =  c(&quot;tCholesterol&quot;, &quot;HDL&quot;, &quot;LDL&quot;, &quot;TG&quot;), id.vars = c(&quot;FID&quot;,&quot;ID&quot;,&quot;sex&quot;,&quot;age&quot;), variable.name = &quot;Lipid&quot;, value.name = &quot;value&quot;, na.rm =F)

kable(
  benchmark(
  dcast.df = dcast(melt.df, ... ~ Lipid, value.var = &quot;value&quot;), 
  dcast.dt  = dcast(ph.long, ... ~ Lipid, value.var = &quot;value&quot;) , 
  replications = 10 
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">dcast.df</td>
<td align="right">10</td>
<td align="right">0.209</td>
<td align="right">3.029</td>
<td align="right">0.463</td>
<td align="right">0.692</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">dcast.dt</td>
<td align="right">10</td>
<td align="right">0.069</td>
<td align="right">1.000</td>
<td align="right">0.259</td>
<td align="right">0.000</td>
<td align="right">0</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p>기타 <code>data.table</code>의 장점에 대해서는 <a href="https://jangorecki.github.io/blog/2015-12-11/Solve-common-R-problems-efficiently-with-data.table.html" class="uri">https://jangorecki.github.io/blog/2015-12-11/Solve-common-R-problems-efficiently-with-data.table.html</a> 를 참고하기 바란다.</p>
</div>
</div>
</div>
<div id="faster-for-loop" class="section level1">
<h1>Faster for-loop</h1>
<p>이번엔 <code>for</code> loop과 <code>lapply</code>, <code>mapply</code> 함수, 그리고 multi-core를 활용한 <code>mclapply</code>, <code>mcmapply</code>함수를 비교하여 어떤 방법이 가장 빠른지 비교해 보겠다.</p>
<p>다양한 phenotype과 다양한 covariate들의 조합을 회귀분석하여 계수들을 뽑아내는 것을 예로 들겠다. 먼저 아래는 종속변수 <code>y</code>와 독립변수 <code>xs</code> 를 넣으면 회귀계수를 구해주는 함수이다.</p>
<pre class="r"><code>CoefExtract = function(y, xs, data=ph){
  form = as.formula(paste(y, xs, sep=&quot;~&quot;))
  reg.model = lm(form, data)
  return(summary(reg.model)$coefficients)
}

kable(
  CoefExtract(&quot;FBS&quot;,&quot;age+sex&quot;)
)</code></pre>
<table>
<thead>
<tr class="header">
<th></th>
<th align="right">Estimate</th>
<th align="right">Std. Error</th>
<th align="right">t value</th>
<th align="right">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(Intercept)</td>
<td align="right">82.2952398</td>
<td align="right">1.2453403</td>
<td align="right">66.082534</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td>age</td>
<td align="right">0.3324244</td>
<td align="right">0.0252670</td>
<td align="right">13.156484</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td>sex</td>
<td align="right">-5.5484049</td>
<td align="right">0.6779199</td>
<td align="right">-8.184455</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<div id="loop" class="section level2 tabset">
<h2>1 loop</h2>
<ul>
<li><p>Phenotype: DXA_total_tscore, FBS, tCholesterol , HDL, LDL, TG, SBP, DBP</p></li>
<li><p>Covariate : age + sex</p></li>
</ul>
<p>8개 조합</p>
<div id="for" class="section level3">
<h3><code>For</code></h3>
<pre class="r"><code>ybar= c(&quot;DXA_total_tscore&quot;, &quot;FBS&quot;,&quot;tCholesterol&quot;,&quot;HDL&quot;,&quot;LDL&quot;,&quot;TG&quot;,&quot;SBP&quot;,&quot;DBP&quot;)


out=list()

for (y in ybar){
  out[[length(out)+1]] = CoefExtract(y,&quot;age+sex&quot;)
}
out</code></pre>
<pre><code>## [[1]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  1.18315428 0.08920472  13.263359 6.016230e-39
## age         -0.03279314 0.00180811 -18.136692 1.786053e-69
## sex         -0.11623913 0.04857521  -2.392972 1.678020e-02
## 
## [[2]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 82.2952398 1.24534026 66.082534 0.000000e+00
## age          0.3324244 0.02526696 13.156484 2.230556e-38
## sex         -5.5484049 0.67791988 -8.184455 4.144824e-16
## 
## [[3]]
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 164.1880367 2.49414564 65.829370 0.000000e+00
## age           0.6030075 0.05060423 11.916148 5.939596e-32
## sex          -2.0602344 1.35772605 -1.517415 1.292774e-01
## 
## [[4]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 50.72179051 0.87234943 58.14389 0.000000e+00
## age         -0.09581274 0.01769928 -5.41337 6.721530e-08
## sex          5.73923189 0.47487666 12.08573 8.479426e-33
## 
## [[5]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 88.2590834 2.13202348 41.396863 2.955579e-291
## age          0.5511586 0.04325706 12.741472  3.634198e-36
## sex         -3.7122724 1.16059935 -3.198582  1.396832e-03
## 
## [[6]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  98.5558111   5.382728  18.309639 9.882907e-71
## age           0.9367979   0.109219   8.577247 1.601135e-17
## sex         -40.9188285   2.929610 -13.967331 7.083359e-43
## 
## [[7]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 96.8058195 1.07102646  90.38602  0.000000e+00
## age          0.5588847 0.02173539  25.71312 9.734928e-131
## sex         -6.5176870 0.58308597 -11.17792  2.144958e-28
## 
## [[8]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 67.5399799 0.74115994 91.127402 0.000000e+00
## age          0.2063502 0.01504109 13.719106 1.800342e-41
## sex         -3.9415045 0.40350073 -9.768271 3.543069e-22</code></pre>
</div>
<div id="lapply" class="section level3">
<h3><code>lapply</code></h3>
<pre class="r"><code>lapply(ybar, CoefExtract, xs=&quot;age+sex&quot;, data=ph)</code></pre>
<pre><code>## [[1]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  1.18315428 0.08920472  13.263359 6.016230e-39
## age         -0.03279314 0.00180811 -18.136692 1.786053e-69
## sex         -0.11623913 0.04857521  -2.392972 1.678020e-02
## 
## [[2]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 82.2952398 1.24534026 66.082534 0.000000e+00
## age          0.3324244 0.02526696 13.156484 2.230556e-38
## sex         -5.5484049 0.67791988 -8.184455 4.144824e-16
## 
## [[3]]
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 164.1880367 2.49414564 65.829370 0.000000e+00
## age           0.6030075 0.05060423 11.916148 5.939596e-32
## sex          -2.0602344 1.35772605 -1.517415 1.292774e-01
## 
## [[4]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 50.72179051 0.87234943 58.14389 0.000000e+00
## age         -0.09581274 0.01769928 -5.41337 6.721530e-08
## sex          5.73923189 0.47487666 12.08573 8.479426e-33
## 
## [[5]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 88.2590834 2.13202348 41.396863 2.955579e-291
## age          0.5511586 0.04325706 12.741472  3.634198e-36
## sex         -3.7122724 1.16059935 -3.198582  1.396832e-03
## 
## [[6]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  98.5558111   5.382728  18.309639 9.882907e-71
## age           0.9367979   0.109219   8.577247 1.601135e-17
## sex         -40.9188285   2.929610 -13.967331 7.083359e-43
## 
## [[7]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 96.8058195 1.07102646  90.38602  0.000000e+00
## age          0.5588847 0.02173539  25.71312 9.734928e-131
## sex         -6.5176870 0.58308597 -11.17792  2.144958e-28
## 
## [[8]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 67.5399799 0.74115994 91.127402 0.000000e+00
## age          0.2063502 0.01504109 13.719106 1.800342e-41
## sex         -3.9415045 0.40350073 -9.768271 3.543069e-22</code></pre>
</div>
<div id="mclapply" class="section level3">
<h3><code>mclapply</code></h3>
<p><code>mclapply</code>는 기본으로 설치된 <strong>parallel</strong> 패키지를 통해 이용할 수 있고 윈도우는 지원하지 않는다.</p>
<pre class="r"><code>library(parallel)

## Setting core
ncore = detectCores()
ncore</code></pre>
<pre><code>## [1] 8</code></pre>
<pre class="r"><code>options(mc.cores= ncore)
options(&quot;mc.cores&quot;)</code></pre>
<pre><code>## $mc.cores
## [1] 8</code></pre>
<pre class="r"><code>mclapply(ybar, CoefExtract, xs=&quot;age+sex&quot;, data=ph)</code></pre>
<pre><code>## [[1]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  1.18315428 0.08920472  13.263359 6.016230e-39
## age         -0.03279314 0.00180811 -18.136692 1.786053e-69
## sex         -0.11623913 0.04857521  -2.392972 1.678020e-02
## 
## [[2]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 82.2952398 1.24534026 66.082534 0.000000e+00
## age          0.3324244 0.02526696 13.156484 2.230556e-38
## sex         -5.5484049 0.67791988 -8.184455 4.144824e-16
## 
## [[3]]
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 164.1880367 2.49414564 65.829370 0.000000e+00
## age           0.6030075 0.05060423 11.916148 5.939596e-32
## sex          -2.0602344 1.35772605 -1.517415 1.292774e-01
## 
## [[4]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 50.72179051 0.87234943 58.14389 0.000000e+00
## age         -0.09581274 0.01769928 -5.41337 6.721530e-08
## sex          5.73923189 0.47487666 12.08573 8.479426e-33
## 
## [[5]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 88.2590834 2.13202348 41.396863 2.955579e-291
## age          0.5511586 0.04325706 12.741472  3.634198e-36
## sex         -3.7122724 1.16059935 -3.198582  1.396832e-03
## 
## [[6]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  98.5558111   5.382728  18.309639 9.882907e-71
## age           0.9367979   0.109219   8.577247 1.601135e-17
## sex         -40.9188285   2.929610 -13.967331 7.083359e-43
## 
## [[7]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 96.8058195 1.07102646  90.38602  0.000000e+00
## age          0.5588847 0.02173539  25.71312 9.734928e-131
## sex         -6.5176870 0.58308597 -11.17792  2.144958e-28
## 
## [[8]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 67.5399799 0.74115994 91.127402 0.000000e+00
## age          0.2063502 0.01504109 13.719106 1.800342e-41
## sex         -3.9415045 0.40350073 -9.768271 3.543069e-22</code></pre>
</div>
<div id="benchmark-7" class="section level3">
<h3>Benchmark</h3>
<pre class="r"><code>kable(
  benchmark(
    CoefExtract.for = {out=list(); for (y in ybar){out[[length(out)+1]] = CoefExtract(y,&quot;age+sex&quot;)}},
    CoefExtract.lapply = lapply(ybar, CoefExtract, xs=&quot;age+sex&quot;, data=ph),
    CoefExtract.mclapply = mclapply(ybar, CoefExtract, xs=&quot;age+sex&quot;, data=ph), replications= 10
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CoefExtract.for</td>
<td align="right">10</td>
<td align="right">0.261</td>
<td align="right">1.111</td>
<td align="right">0.261</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">CoefExtract.lapply</td>
<td align="right">10</td>
<td align="right">0.235</td>
<td align="right">1.000</td>
<td align="right">0.234</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">CoefExtract.mclapply</td>
<td align="right">10</td>
<td align="right">0.629</td>
<td align="right">2.677</td>
<td align="right">0.033</td>
<td align="right">0.492</td>
<td align="right">0.574</td>
<td align="right">0.787</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="loops" class="section level2 tabset">
<h2>2 loops</h2>
<ul>
<li><p>Phenotype: DXA_total_tscore, FBS, tCholesterol , HDL, LDL, TG, SBP, DBP</p></li>
<li><p>Covariate : No, age, age + sex, age + sex + BMI, age + sex + BMI + smoke + alcohol</p></li>
</ul>
<p>총 40개 조합.</p>
<pre class="r"><code>ybar= c(&quot;DXA_total_tscore&quot;, &quot;FBS&quot;,&quot;tCholesterol&quot;,&quot;HDL&quot;,&quot;LDL&quot;,&quot;TG&quot;,&quot;SBP&quot;,&quot;DBP&quot;)
xbar= c(&quot;1&quot;,&quot;age&quot;, &quot;age + sex&quot;, &quot;age + sex + BMI&quot;, &quot;age + sex + BMI + smoke + alcohol &quot;)</code></pre>
<div id="for-1" class="section level3">
<h3><code>for</code></h3>
<pre class="r"><code>out=list()

for (y in ybar){
  for (xs in xbar){
    out[[length(out)+1]] = CoefExtract(y, xs)
  }
}
out</code></pre>
<pre><code>## [[1]]
##               Estimate Std. Error   t value    Pr(&gt;|t|)
## (Intercept) -0.3379654 0.02503942 -13.49733 3.13349e-40
## 
## [[2]]
##                Estimate  Std. Error   t value     Pr(&gt;|t|)
## (Intercept)  1.10698381 0.083404931  13.27240 5.366516e-39
## age         -0.03268478 0.001809118 -18.06669 5.532920e-69
## 
## [[3]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  1.18315428 0.08920472  13.263359 6.016230e-39
## age         -0.03279314 0.00180811 -18.136692 1.786053e-69
## sex         -0.11623913 0.04857521  -2.392972 1.678020e-02
## 
## [[4]]
##                 Estimate  Std. Error     t value     Pr(&gt;|t|)
## (Intercept) -0.831563111 0.184102012  -4.5168605 6.545133e-06
## age         -0.037572423 0.001799589 -20.8783324 7.058002e-90
## sex         -0.006860562 0.048058658  -0.1427539 8.864952e-01
## BMI          0.091340414 0.007346979  12.4323778 1.502111e-34
## 
## [[5]]
##                Estimate  Std. Error    t value     Pr(&gt;|t|)
## (Intercept) -0.73765347 0.222698896  -3.312336 9.374104e-04
## age         -0.03700925 0.001883908 -19.644936 2.057143e-80
## sex         -0.10272560 0.061351996  -1.674364 9.417495e-02
## BMI          0.09076497 0.007342021  12.362395 3.457890e-34
## smoke       -0.11702823 0.035615571  -3.285873 1.029688e-03
## alcohol      0.05804926 0.028477854   2.038400 4.160729e-02
## 
## [[6]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 93.59679  0.3447227 271.5133        0
## 
## [[7]]
##              Estimate Std. Error  t value    Pr(&gt;|t|)
## (Intercept) 78.679816 1.17831767 66.77301 0.00000e+00
## age          0.337473 0.02556222 13.20202 1.26334e-38
## 
## [[8]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 82.2952398 1.24534026 66.082534 0.000000e+00
## age          0.3324244 0.02526696 13.156484 2.230556e-38
## sex         -5.5484049 0.67791988 -8.184455 4.144824e-16
## 
## [[9]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 63.9065756 2.61870235 24.403910 3.688355e-119
## age          0.2905877 0.02557697 11.361300  2.924312e-29
## sex         -4.5777251 0.68200819 -6.712126  2.323673e-11
## BMI          0.8300624 0.10458434  7.936775  3.000944e-15
## 
## [[10]]
##               Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 60.1455518 3.17678185 18.9328555 3.377702e-75
## age          0.3037790 0.02686746 11.3065755 5.340063e-29
## sex         -3.4069494 0.87293887 -3.9028499 9.737209e-05
## BMI          0.8378636 0.10485473  7.9907083 1.962289e-15
## smoke        0.8850039 0.50701065  1.7455332 8.100493e-02
## alcohol      0.3938682 0.40648983  0.9689498 3.326563e-01
## 
## [[11]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 189.5825  0.6786983 279.3326        0
## 
## [[12]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 162.8455571 2.33251609 69.81541 0.000000e+00
## age           0.6048822 0.05060119 11.95391 3.856016e-32
## 
## [[13]]
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 164.1880367 2.49414564 65.829370 0.000000e+00
## age           0.6030075 0.05060423 11.916148 5.939596e-32
## sex          -2.0602344 1.35772605 -1.517415 1.292774e-01
## 
## [[14]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 122.7682651 5.23010885 23.4733671 3.777693e-111
## age           0.5058568 0.05108269  9.9027059  9.739034e-23
## sex           0.1797371 1.36211627  0.1319543  8.950302e-01
## BMI           1.8750125 0.20887731  8.9766214  5.073238e-19
## 
## [[15]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 114.8944422 6.32564793 18.1632686 1.116759e-69
## age           0.5197287 0.05349883  9.7147679 5.902210e-22
## sex           3.3472580 1.73820684  1.9256960 5.424639e-02
## BMI           1.8776061 0.20878806  8.9928808 4.404104e-19
## smoke         2.8883676 1.00956597  2.8609994 4.255290e-03
## alcohol       0.3095217 0.80940766  0.3824052 7.021907e-01
## 
## [[16]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 49.99562  0.2387532 209.4029        0
## 
## [[17]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 54.4615603 0.83696720 65.070125 0.000000e+00
## age         -0.1010349 0.01815702 -5.564511 2.883674e-08
## 
## [[18]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 50.72179051 0.87234943 58.14389 0.000000e+00
## age         -0.09581274 0.01769928 -5.41337 6.721530e-08
## sex          5.73923189 0.47487666 12.08573 8.479426e-33
## 
## [[19]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 70.51251978 1.80567194  39.050571 1.953060e-265
## age         -0.04996883 0.01763607  -2.833331  4.640359e-03
## sex          4.67683256 0.47026461   9.945108  6.462027e-23
## BMI         -0.89484535 0.07211397 -12.408766  1.948859e-34
## 
## [[20]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 64.20012687 2.17841379  29.471043 6.339215e-166
## age         -0.02200388 0.01842382  -1.194317  2.324580e-01
## sex          6.05321827 0.59860014  10.112290  1.266824e-23
## BMI         -0.88922960 0.07190201 -12.367243  3.205323e-34
## smoke        0.65970025 0.34767228   1.897477  5.787070e-02
## alcohol      1.31674087 0.27874217   4.723867  2.431448e-06
## 
## [[21]]
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 110.3517  0.5831126 189.246        0
## 
## [[22]]
##               Estimate Std. Error t value      Pr(&gt;|t|)
## (Intercept) 85.8401109 1.99674617 42.9900 5.681223e-309
## age          0.5545365 0.04331706 12.8018  1.747137e-36
## 
## [[23]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 88.2590834 2.13202348 41.396863 2.955579e-291
## age          0.5511586 0.04325706 12.741472  3.634198e-36
## sex         -3.7122724 1.16059935 -3.198582  1.396832e-03
## 
## [[24]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 46.9780380 4.44686481 10.564305 1.349740e-25
## age          0.4544901 0.04343271 10.464234 3.743974e-25
## sex         -1.4772736 1.15813018 -1.275568 2.022168e-01
## BMI          1.8684460 0.17759652 10.520735 2.106848e-25
## 
## [[25]]
##               Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 51.3472610 5.38727954  9.5312041 3.317163e-21
## age          0.4204558 0.04556263  9.2280843 5.372290e-20
## sex         -1.5564993 1.48035526 -1.0514364 2.931516e-01
## BMI          1.8659773 0.17781572 10.4938829 2.780782e-25
## smoke        0.7554175 0.85980348  0.8785933 3.796994e-01
## alcohol     -1.6911739 0.68933734 -2.4533328 1.421622e-02
## 
## [[26]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 114.9459    1.49712 76.77802        0
## 
## [[27]]
##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 71.8690680   5.207705 13.80053 6.224706e-42
## age          0.9746975   0.112993  8.62618 1.056875e-17
## 
## [[28]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  98.5558111   5.382728  18.309639 9.882907e-71
## age           0.9367979   0.109219   8.577247 1.601135e-17
## sex         -40.9188285   2.929610 -13.967331 7.083359e-43
## 
## [[29]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) -61.8235400 10.9100869  -5.666640 1.608477e-08
## age           0.5652551  0.1065660   5.304271 1.221816e-07
## sex         -32.2921274  2.8411518 -11.365858 2.783645e-29
## BMI           7.2516766  0.4356443  16.645866 2.467171e-59
## 
## [[30]]
##                 Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) -103.3730606 13.1336369 -7.870863 5.040792e-15
## age            0.6760743  0.1110898  6.085834 1.321844e-09
## sex          -17.1854270  3.6089380 -4.761907 2.018190e-06
## BMI            7.3001863  0.4335010 16.840070 1.310279e-60
## smoke         13.2007428  2.0959972  6.298073 3.502561e-10
## alcohol        2.4392043  1.6806952  1.451307 1.468098e-01
## 
## [[31]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 117.5271   0.323093 363.7563        0
## 
## [[32]]
##               Estimate Std. Error  t value      Pr(&gt;|t|)
## (Intercept) 92.5662939  1.0241235 90.38587  0.000000e+00
## age          0.5647055  0.0222173 25.41738 4.329773e-128
## 
## [[33]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 96.8058195 1.07102646  90.38602  0.000000e+00
## age          0.5588847 0.02173539  25.71312 9.734928e-131
## sex         -6.5176870 0.58308597 -11.17792  2.144958e-28
## 
## [[34]]
##              Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 70.556786 2.20727979 31.965493 1.125800e-190
## age          0.498183 0.02155045 23.117058 4.134648e-108
## sex         -5.105478 0.57474987 -8.882957  1.156815e-18
## BMI          1.186790 0.08813541 13.465533  4.635262e-40
## 
## [[35]]
##               Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 70.1220591 2.67610689 26.2030113 4.168194e-135
## age          0.4992206 0.02262375 22.0662219  2.208439e-99
## sex         -5.1038772 0.73467473 -6.9471250  4.649089e-12
## BMI          1.1918429 0.08833169 13.4928123  3.311817e-40
## smoke       -0.0889666 0.42679757 -0.2084515  8.348921e-01
## alcohol      0.1709080 0.34235495  0.4992129  6.176699e-01
## 
## [[36]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 74.25275   0.206785 359.0818        0
## 
## [[37]]
##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 64.9761702 0.70502446 92.16158 0.000000e+00
## age          0.2098704 0.01529477 13.72170 1.739099e-41
## 
## [[38]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 67.5399799 0.74115994 91.127402 0.000000e+00
## age          0.2063502 0.01504109 13.719106 1.800342e-41
## sex         -3.9415045 0.40350073 -9.768271 3.543069e-22
## 
## [[39]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 50.7850605 1.53494913 33.085826 4.392114e-202
## age          0.1674870 0.01498625 11.176048  2.191898e-28
## sex         -3.0402415 0.39968282 -7.606636  3.848708e-14
## BMI          0.7577493 0.06128963 12.363417  3.348170e-34
## 
## [[40]]
##               Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 51.4465460 1.86163767 27.6351015 2.449444e-148
## age          0.1641266 0.01573824 10.4285224  5.414314e-25
## sex         -3.2052800 0.51107755 -6.2716118  4.144386e-10
## BMI          0.7564303 0.06144807 12.3100741  6.315632e-34
## smoke       -0.1044255 0.29690235 -0.3517166  7.250781e-01
## alcohol     -0.1001832 0.23815972 -0.4206557  6.740398e-01</code></pre>
</div>
<div id="mapply" class="section level3">
<h3><code>mapply</code></h3>
<pre class="r"><code>yx.list = CJ(y= ybar, xs= xbar)
mapply(CoefExtract, yx.list[, y], yx.list[, xs], MoreArgs = list(data =ph), USE.NAMES = F)</code></pre>
<pre><code>## [[1]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 74.25275   0.206785 359.0818        0
## 
## [[2]]
##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 64.9761702 0.70502446 92.16158 0.000000e+00
## age          0.2098704 0.01529477 13.72170 1.739099e-41
## 
## [[3]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 67.5399799 0.74115994 91.127402 0.000000e+00
## age          0.2063502 0.01504109 13.719106 1.800342e-41
## sex         -3.9415045 0.40350073 -9.768271 3.543069e-22
## 
## [[4]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 50.7850605 1.53494913 33.085826 4.392114e-202
## age          0.1674870 0.01498625 11.176048  2.191898e-28
## sex         -3.0402415 0.39968282 -7.606636  3.848708e-14
## BMI          0.7577493 0.06128963 12.363417  3.348170e-34
## 
## [[5]]
##               Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 51.4465460 1.86163767 27.6351015 2.449444e-148
## age          0.1641266 0.01573824 10.4285224  5.414314e-25
## sex         -3.2052800 0.51107755 -6.2716118  4.144386e-10
## BMI          0.7564303 0.06144807 12.3100741  6.315632e-34
## smoke       -0.1044255 0.29690235 -0.3517166  7.250781e-01
## alcohol     -0.1001832 0.23815972 -0.4206557  6.740398e-01
## 
## [[6]]
##               Estimate Std. Error   t value    Pr(&gt;|t|)
## (Intercept) -0.3379654 0.02503942 -13.49733 3.13349e-40
## 
## [[7]]
##                Estimate  Std. Error   t value     Pr(&gt;|t|)
## (Intercept)  1.10698381 0.083404931  13.27240 5.366516e-39
## age         -0.03268478 0.001809118 -18.06669 5.532920e-69
## 
## [[8]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  1.18315428 0.08920472  13.263359 6.016230e-39
## age         -0.03279314 0.00180811 -18.136692 1.786053e-69
## sex         -0.11623913 0.04857521  -2.392972 1.678020e-02
## 
## [[9]]
##                 Estimate  Std. Error     t value     Pr(&gt;|t|)
## (Intercept) -0.831563111 0.184102012  -4.5168605 6.545133e-06
## age         -0.037572423 0.001799589 -20.8783324 7.058002e-90
## sex         -0.006860562 0.048058658  -0.1427539 8.864952e-01
## BMI          0.091340414 0.007346979  12.4323778 1.502111e-34
## 
## [[10]]
##                Estimate  Std. Error    t value     Pr(&gt;|t|)
## (Intercept) -0.73765347 0.222698896  -3.312336 9.374104e-04
## age         -0.03700925 0.001883908 -19.644936 2.057143e-80
## sex         -0.10272560 0.061351996  -1.674364 9.417495e-02
## BMI          0.09076497 0.007342021  12.362395 3.457890e-34
## smoke       -0.11702823 0.035615571  -3.285873 1.029688e-03
## alcohol      0.05804926 0.028477854   2.038400 4.160729e-02
## 
## [[11]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 93.59679  0.3447227 271.5133        0
## 
## [[12]]
##              Estimate Std. Error  t value    Pr(&gt;|t|)
## (Intercept) 78.679816 1.17831767 66.77301 0.00000e+00
## age          0.337473 0.02556222 13.20202 1.26334e-38
## 
## [[13]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 82.2952398 1.24534026 66.082534 0.000000e+00
## age          0.3324244 0.02526696 13.156484 2.230556e-38
## sex         -5.5484049 0.67791988 -8.184455 4.144824e-16
## 
## [[14]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 63.9065756 2.61870235 24.403910 3.688355e-119
## age          0.2905877 0.02557697 11.361300  2.924312e-29
## sex         -4.5777251 0.68200819 -6.712126  2.323673e-11
## BMI          0.8300624 0.10458434  7.936775  3.000944e-15
## 
## [[15]]
##               Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 60.1455518 3.17678185 18.9328555 3.377702e-75
## age          0.3037790 0.02686746 11.3065755 5.340063e-29
## sex         -3.4069494 0.87293887 -3.9028499 9.737209e-05
## BMI          0.8378636 0.10485473  7.9907083 1.962289e-15
## smoke        0.8850039 0.50701065  1.7455332 8.100493e-02
## alcohol      0.3938682 0.40648983  0.9689498 3.326563e-01
## 
## [[16]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 49.99562  0.2387532 209.4029        0
## 
## [[17]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 54.4615603 0.83696720 65.070125 0.000000e+00
## age         -0.1010349 0.01815702 -5.564511 2.883674e-08
## 
## [[18]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 50.72179051 0.87234943 58.14389 0.000000e+00
## age         -0.09581274 0.01769928 -5.41337 6.721530e-08
## sex          5.73923189 0.47487666 12.08573 8.479426e-33
## 
## [[19]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 70.51251978 1.80567194  39.050571 1.953060e-265
## age         -0.04996883 0.01763607  -2.833331  4.640359e-03
## sex          4.67683256 0.47026461   9.945108  6.462027e-23
## BMI         -0.89484535 0.07211397 -12.408766  1.948859e-34
## 
## [[20]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 64.20012687 2.17841379  29.471043 6.339215e-166
## age         -0.02200388 0.01842382  -1.194317  2.324580e-01
## sex          6.05321827 0.59860014  10.112290  1.266824e-23
## BMI         -0.88922960 0.07190201 -12.367243  3.205323e-34
## smoke        0.65970025 0.34767228   1.897477  5.787070e-02
## alcohol      1.31674087 0.27874217   4.723867  2.431448e-06
## 
## [[21]]
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 110.3517  0.5831126 189.246        0
## 
## [[22]]
##               Estimate Std. Error t value      Pr(&gt;|t|)
## (Intercept) 85.8401109 1.99674617 42.9900 5.681223e-309
## age          0.5545365 0.04331706 12.8018  1.747137e-36
## 
## [[23]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 88.2590834 2.13202348 41.396863 2.955579e-291
## age          0.5511586 0.04325706 12.741472  3.634198e-36
## sex         -3.7122724 1.16059935 -3.198582  1.396832e-03
## 
## [[24]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 46.9780380 4.44686481 10.564305 1.349740e-25
## age          0.4544901 0.04343271 10.464234 3.743974e-25
## sex         -1.4772736 1.15813018 -1.275568 2.022168e-01
## BMI          1.8684460 0.17759652 10.520735 2.106848e-25
## 
## [[25]]
##               Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 51.3472610 5.38727954  9.5312041 3.317163e-21
## age          0.4204558 0.04556263  9.2280843 5.372290e-20
## sex         -1.5564993 1.48035526 -1.0514364 2.931516e-01
## BMI          1.8659773 0.17781572 10.4938829 2.780782e-25
## smoke        0.7554175 0.85980348  0.8785933 3.796994e-01
## alcohol     -1.6911739 0.68933734 -2.4533328 1.421622e-02
## 
## [[26]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 117.5271   0.323093 363.7563        0
## 
## [[27]]
##               Estimate Std. Error  t value      Pr(&gt;|t|)
## (Intercept) 92.5662939  1.0241235 90.38587  0.000000e+00
## age          0.5647055  0.0222173 25.41738 4.329773e-128
## 
## [[28]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 96.8058195 1.07102646  90.38602  0.000000e+00
## age          0.5588847 0.02173539  25.71312 9.734928e-131
## sex         -6.5176870 0.58308597 -11.17792  2.144958e-28
## 
## [[29]]
##              Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 70.556786 2.20727979 31.965493 1.125800e-190
## age          0.498183 0.02155045 23.117058 4.134648e-108
## sex         -5.105478 0.57474987 -8.882957  1.156815e-18
## BMI          1.186790 0.08813541 13.465533  4.635262e-40
## 
## [[30]]
##               Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 70.1220591 2.67610689 26.2030113 4.168194e-135
## age          0.4992206 0.02262375 22.0662219  2.208439e-99
## sex         -5.1038772 0.73467473 -6.9471250  4.649089e-12
## BMI          1.1918429 0.08833169 13.4928123  3.311817e-40
## smoke       -0.0889666 0.42679757 -0.2084515  8.348921e-01
## alcohol      0.1709080 0.34235495  0.4992129  6.176699e-01
## 
## [[31]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 114.9459    1.49712 76.77802        0
## 
## [[32]]
##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 71.8690680   5.207705 13.80053 6.224706e-42
## age          0.9746975   0.112993  8.62618 1.056875e-17
## 
## [[33]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  98.5558111   5.382728  18.309639 9.882907e-71
## age           0.9367979   0.109219   8.577247 1.601135e-17
## sex         -40.9188285   2.929610 -13.967331 7.083359e-43
## 
## [[34]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) -61.8235400 10.9100869  -5.666640 1.608477e-08
## age           0.5652551  0.1065660   5.304271 1.221816e-07
## sex         -32.2921274  2.8411518 -11.365858 2.783645e-29
## BMI           7.2516766  0.4356443  16.645866 2.467171e-59
## 
## [[35]]
##                 Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) -103.3730606 13.1336369 -7.870863 5.040792e-15
## age            0.6760743  0.1110898  6.085834 1.321844e-09
## sex          -17.1854270  3.6089380 -4.761907 2.018190e-06
## BMI            7.3001863  0.4335010 16.840070 1.310279e-60
## smoke         13.2007428  2.0959972  6.298073 3.502561e-10
## alcohol        2.4392043  1.6806952  1.451307 1.468098e-01
## 
## [[36]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 189.5825  0.6786983 279.3326        0
## 
## [[37]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 162.8455571 2.33251609 69.81541 0.000000e+00
## age           0.6048822 0.05060119 11.95391 3.856016e-32
## 
## [[38]]
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 164.1880367 2.49414564 65.829370 0.000000e+00
## age           0.6030075 0.05060423 11.916148 5.939596e-32
## sex          -2.0602344 1.35772605 -1.517415 1.292774e-01
## 
## [[39]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 122.7682651 5.23010885 23.4733671 3.777693e-111
## age           0.5058568 0.05108269  9.9027059  9.739034e-23
## sex           0.1797371 1.36211627  0.1319543  8.950302e-01
## BMI           1.8750125 0.20887731  8.9766214  5.073238e-19
## 
## [[40]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 114.8944422 6.32564793 18.1632686 1.116759e-69
## age           0.5197287 0.05349883  9.7147679 5.902210e-22
## sex           3.3472580 1.73820684  1.9256960 5.424639e-02
## BMI           1.8776061 0.20878806  8.9928808 4.404104e-19
## smoke         2.8883676 1.00956597  2.8609994 4.255290e-03
## alcohol       0.3095217 0.80940766  0.3824052 7.021907e-01</code></pre>
</div>
<div id="mcmapply" class="section level3">
<h3><code>mcmapply</code></h3>
<pre class="r"><code>mcmapply(CoefExtract, yx.list[, y], yx.list[, xs], MoreArgs = list(data =ph), USE.NAMES = F)</code></pre>
<pre><code>## [[1]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 74.25275   0.206785 359.0818        0
## 
## [[2]]
##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 64.9761702 0.70502446 92.16158 0.000000e+00
## age          0.2098704 0.01529477 13.72170 1.739099e-41
## 
## [[3]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 67.5399799 0.74115994 91.127402 0.000000e+00
## age          0.2063502 0.01504109 13.719106 1.800342e-41
## sex         -3.9415045 0.40350073 -9.768271 3.543069e-22
## 
## [[4]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 50.7850605 1.53494913 33.085826 4.392114e-202
## age          0.1674870 0.01498625 11.176048  2.191898e-28
## sex         -3.0402415 0.39968282 -7.606636  3.848708e-14
## BMI          0.7577493 0.06128963 12.363417  3.348170e-34
## 
## [[5]]
##               Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 51.4465460 1.86163767 27.6351015 2.449444e-148
## age          0.1641266 0.01573824 10.4285224  5.414314e-25
## sex         -3.2052800 0.51107755 -6.2716118  4.144386e-10
## BMI          0.7564303 0.06144807 12.3100741  6.315632e-34
## smoke       -0.1044255 0.29690235 -0.3517166  7.250781e-01
## alcohol     -0.1001832 0.23815972 -0.4206557  6.740398e-01
## 
## [[6]]
##               Estimate Std. Error   t value    Pr(&gt;|t|)
## (Intercept) -0.3379654 0.02503942 -13.49733 3.13349e-40
## 
## [[7]]
##                Estimate  Std. Error   t value     Pr(&gt;|t|)
## (Intercept)  1.10698381 0.083404931  13.27240 5.366516e-39
## age         -0.03268478 0.001809118 -18.06669 5.532920e-69
## 
## [[8]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  1.18315428 0.08920472  13.263359 6.016230e-39
## age         -0.03279314 0.00180811 -18.136692 1.786053e-69
## sex         -0.11623913 0.04857521  -2.392972 1.678020e-02
## 
## [[9]]
##                 Estimate  Std. Error     t value     Pr(&gt;|t|)
## (Intercept) -0.831563111 0.184102012  -4.5168605 6.545133e-06
## age         -0.037572423 0.001799589 -20.8783324 7.058002e-90
## sex         -0.006860562 0.048058658  -0.1427539 8.864952e-01
## BMI          0.091340414 0.007346979  12.4323778 1.502111e-34
## 
## [[10]]
##                Estimate  Std. Error    t value     Pr(&gt;|t|)
## (Intercept) -0.73765347 0.222698896  -3.312336 9.374104e-04
## age         -0.03700925 0.001883908 -19.644936 2.057143e-80
## sex         -0.10272560 0.061351996  -1.674364 9.417495e-02
## BMI          0.09076497 0.007342021  12.362395 3.457890e-34
## smoke       -0.11702823 0.035615571  -3.285873 1.029688e-03
## alcohol      0.05804926 0.028477854   2.038400 4.160729e-02
## 
## [[11]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 93.59679  0.3447227 271.5133        0
## 
## [[12]]
##              Estimate Std. Error  t value    Pr(&gt;|t|)
## (Intercept) 78.679816 1.17831767 66.77301 0.00000e+00
## age          0.337473 0.02556222 13.20202 1.26334e-38
## 
## [[13]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 82.2952398 1.24534026 66.082534 0.000000e+00
## age          0.3324244 0.02526696 13.156484 2.230556e-38
## sex         -5.5484049 0.67791988 -8.184455 4.144824e-16
## 
## [[14]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 63.9065756 2.61870235 24.403910 3.688355e-119
## age          0.2905877 0.02557697 11.361300  2.924312e-29
## sex         -4.5777251 0.68200819 -6.712126  2.323673e-11
## BMI          0.8300624 0.10458434  7.936775  3.000944e-15
## 
## [[15]]
##               Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 60.1455518 3.17678185 18.9328555 3.377702e-75
## age          0.3037790 0.02686746 11.3065755 5.340063e-29
## sex         -3.4069494 0.87293887 -3.9028499 9.737209e-05
## BMI          0.8378636 0.10485473  7.9907083 1.962289e-15
## smoke        0.8850039 0.50701065  1.7455332 8.100493e-02
## alcohol      0.3938682 0.40648983  0.9689498 3.326563e-01
## 
## [[16]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 49.99562  0.2387532 209.4029        0
## 
## [[17]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 54.4615603 0.83696720 65.070125 0.000000e+00
## age         -0.1010349 0.01815702 -5.564511 2.883674e-08
## 
## [[18]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 50.72179051 0.87234943 58.14389 0.000000e+00
## age         -0.09581274 0.01769928 -5.41337 6.721530e-08
## sex          5.73923189 0.47487666 12.08573 8.479426e-33
## 
## [[19]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 70.51251978 1.80567194  39.050571 1.953060e-265
## age         -0.04996883 0.01763607  -2.833331  4.640359e-03
## sex          4.67683256 0.47026461   9.945108  6.462027e-23
## BMI         -0.89484535 0.07211397 -12.408766  1.948859e-34
## 
## [[20]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 64.20012687 2.17841379  29.471043 6.339215e-166
## age         -0.02200388 0.01842382  -1.194317  2.324580e-01
## sex          6.05321827 0.59860014  10.112290  1.266824e-23
## BMI         -0.88922960 0.07190201 -12.367243  3.205323e-34
## smoke        0.65970025 0.34767228   1.897477  5.787070e-02
## alcohol      1.31674087 0.27874217   4.723867  2.431448e-06
## 
## [[21]]
##             Estimate Std. Error t value Pr(&gt;|t|)
## (Intercept) 110.3517  0.5831126 189.246        0
## 
## [[22]]
##               Estimate Std. Error t value      Pr(&gt;|t|)
## (Intercept) 85.8401109 1.99674617 42.9900 5.681223e-309
## age          0.5545365 0.04331706 12.8018  1.747137e-36
## 
## [[23]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 88.2590834 2.13202348 41.396863 2.955579e-291
## age          0.5511586 0.04325706 12.741472  3.634198e-36
## sex         -3.7122724 1.16059935 -3.198582  1.396832e-03
## 
## [[24]]
##               Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 46.9780380 4.44686481 10.564305 1.349740e-25
## age          0.4544901 0.04343271 10.464234 3.743974e-25
## sex         -1.4772736 1.15813018 -1.275568 2.022168e-01
## BMI          1.8684460 0.17759652 10.520735 2.106848e-25
## 
## [[25]]
##               Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 51.3472610 5.38727954  9.5312041 3.317163e-21
## age          0.4204558 0.04556263  9.2280843 5.372290e-20
## sex         -1.5564993 1.48035526 -1.0514364 2.931516e-01
## BMI          1.8659773 0.17781572 10.4938829 2.780782e-25
## smoke        0.7554175 0.85980348  0.8785933 3.796994e-01
## alcohol     -1.6911739 0.68933734 -2.4533328 1.421622e-02
## 
## [[26]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 117.5271   0.323093 363.7563        0
## 
## [[27]]
##               Estimate Std. Error  t value      Pr(&gt;|t|)
## (Intercept) 92.5662939  1.0241235 90.38587  0.000000e+00
## age          0.5647055  0.0222173 25.41738 4.329773e-128
## 
## [[28]]
##               Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 96.8058195 1.07102646  90.38602  0.000000e+00
## age          0.5588847 0.02173539  25.71312 9.734928e-131
## sex         -6.5176870 0.58308597 -11.17792  2.144958e-28
## 
## [[29]]
##              Estimate Std. Error   t value      Pr(&gt;|t|)
## (Intercept) 70.556786 2.20727979 31.965493 1.125800e-190
## age          0.498183 0.02155045 23.117058 4.134648e-108
## sex         -5.105478 0.57474987 -8.882957  1.156815e-18
## BMI          1.186790 0.08813541 13.465533  4.635262e-40
## 
## [[30]]
##               Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 70.1220591 2.67610689 26.2030113 4.168194e-135
## age          0.4992206 0.02262375 22.0662219  2.208439e-99
## sex         -5.1038772 0.73467473 -6.9471250  4.649089e-12
## BMI          1.1918429 0.08833169 13.4928123  3.311817e-40
## smoke       -0.0889666 0.42679757 -0.2084515  8.348921e-01
## alcohol      0.1709080 0.34235495  0.4992129  6.176699e-01
## 
## [[31]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 114.9459    1.49712 76.77802        0
## 
## [[32]]
##               Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 71.8690680   5.207705 13.80053 6.224706e-42
## age          0.9746975   0.112993  8.62618 1.056875e-17
## 
## [[33]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept)  98.5558111   5.382728  18.309639 9.882907e-71
## age           0.9367979   0.109219   8.577247 1.601135e-17
## sex         -40.9188285   2.929610 -13.967331 7.083359e-43
## 
## [[34]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) -61.8235400 10.9100869  -5.666640 1.608477e-08
## age           0.5652551  0.1065660   5.304271 1.221816e-07
## sex         -32.2921274  2.8411518 -11.365858 2.783645e-29
## BMI           7.2516766  0.4356443  16.645866 2.467171e-59
## 
## [[35]]
##                 Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) -103.3730606 13.1336369 -7.870863 5.040792e-15
## age            0.6760743  0.1110898  6.085834 1.321844e-09
## sex          -17.1854270  3.6089380 -4.761907 2.018190e-06
## BMI            7.3001863  0.4335010 16.840070 1.310279e-60
## smoke         13.2007428  2.0959972  6.298073 3.502561e-10
## alcohol        2.4392043  1.6806952  1.451307 1.468098e-01
## 
## [[36]]
##             Estimate Std. Error  t value Pr(&gt;|t|)
## (Intercept) 189.5825  0.6786983 279.3326        0
## 
## [[37]]
##                Estimate Std. Error  t value     Pr(&gt;|t|)
## (Intercept) 162.8455571 2.33251609 69.81541 0.000000e+00
## age           0.6048822 0.05060119 11.95391 3.856016e-32
## 
## [[38]]
##                Estimate Std. Error   t value     Pr(&gt;|t|)
## (Intercept) 164.1880367 2.49414564 65.829370 0.000000e+00
## age           0.6030075 0.05060423 11.916148 5.939596e-32
## sex          -2.0602344 1.35772605 -1.517415 1.292774e-01
## 
## [[39]]
##                Estimate Std. Error    t value      Pr(&gt;|t|)
## (Intercept) 122.7682651 5.23010885 23.4733671 3.777693e-111
## age           0.5058568 0.05108269  9.9027059  9.739034e-23
## sex           0.1797371 1.36211627  0.1319543  8.950302e-01
## BMI           1.8750125 0.20887731  8.9766214  5.073238e-19
## 
## [[40]]
##                Estimate Std. Error    t value     Pr(&gt;|t|)
## (Intercept) 114.8944422 6.32564793 18.1632686 1.116759e-69
## age           0.5197287 0.05349883  9.7147679 5.902210e-22
## sex           3.3472580 1.73820684  1.9256960 5.424639e-02
## BMI           1.8776061 0.20878806  8.9928808 4.404104e-19
## smoke         2.8883676 1.00956597  2.8609994 4.255290e-03
## alcohol       0.3095217 0.80940766  0.3824052 7.021907e-01</code></pre>
</div>
<div id="benchmark-8" class="section level3">
<h3>Benchmark</h3>
<pre class="r"><code>kable(
  benchmark(
    CoefExtract.for2 = {out=list();for (y in ybar){for (xs in xbar){out[[length(out)+1]] = CoefExtract(y, xs)}}},
    CoefExtract.mapply = mapply(CoefExtract, yx.list[, y], yx.list[, xs], MoreArgs = list(data =ph), USE.NAMES = F),
    CoefExtract.mcmapply = mcmapply(CoefExtract, yx.list[, y], yx.list[, xs], MoreArgs = list(data =ph), USE.NAMES = F), replications= 10
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">CoefExtract.for2</td>
<td align="right">10</td>
<td align="right">1.241</td>
<td align="right">1.224</td>
<td align="right">1.229</td>
<td align="right">0.012</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">CoefExtract.mapply</td>
<td align="right">10</td>
<td align="right">1.110</td>
<td align="right">1.095</td>
<td align="right">1.110</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">CoefExtract.mcmapply</td>
<td align="right">10</td>
<td align="right">1.014</td>
<td align="right">1.000</td>
<td align="right">0.040</td>
<td align="right">0.611</td>
<td align="right">2.406</td>
<td align="right">1.348</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="when-we-use-multi-core" class="section level2 tabset">
<h2>When we use multi-core?</h2>
<p>위의 결과를 요약하면 아래와 같다.</p>
<ol style="list-style-type: decimal">
<li><p>마법은 없다. <code>for</code>나 <code>lapply</code>, <code>mapply</code>나 비슷하다.</p></li>
<li>multi-core가 더 느릴 수도 있다.
<ul>
<li>간단한 작업을 조금 반복할 때 특히.</li>
</ul></li>
</ol>
<p>그럼 언제 multi-core가 효과적일까? <span class="math inline">\(N\)</span>초간 정지하는 <code>Sys.sleep</code>함수를 통해 살펴보자.</p>
<div id="n0.0001" class="section level3">
<h3><span class="math inline">\(N=0.0001\)</span></h3>
<pre class="r"><code>N=0.0001

kable(
  benchmark(
    forloop = {for(i in 1:8){Sys.sleep(N)}},
    lapply = lapply(rep(N,8), Sys.sleep),
    mclapply = mclapply(rep(N,8), Sys.sleep), replications= 10
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">forloop</td>
<td align="right">10</td>
<td align="right">0.033</td>
<td align="right">2.75</td>
<td align="right">0.020</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">lapply</td>
<td align="right">10</td>
<td align="right">0.012</td>
<td align="right">1.00</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">mclapply</td>
<td align="right">10</td>
<td align="right">0.660</td>
<td align="right">55.00</td>
<td align="right">0.024</td>
<td align="right">0.563</td>
<td align="right">0.078</td>
<td align="right">0.722</td>
</tr>
</tbody>
</table>
</div>
<div id="n0.001" class="section level3">
<h3><span class="math inline">\(N=0.001\)</span></h3>
<pre class="r"><code>N=0.001

kable(
  benchmark(
    forloop = {for(i in 1:8){Sys.sleep(N)}},
    lapply = lapply(rep(N,8), Sys.sleep),
    mclapply = mclapply(rep(N,8), Sys.sleep), replications= 10
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">forloop</td>
<td align="right">10</td>
<td align="right">0.111</td>
<td align="right">1.133</td>
<td align="right">0.025</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">lapply</td>
<td align="right">10</td>
<td align="right">0.098</td>
<td align="right">1.000</td>
<td align="right">0.001</td>
<td align="right">0.003</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">mclapply</td>
<td align="right">10</td>
<td align="right">0.576</td>
<td align="right">5.878</td>
<td align="right">0.037</td>
<td align="right">0.492</td>
<td align="right">0.069</td>
<td align="right">0.721</td>
</tr>
</tbody>
</table>
</div>
<div id="n0.01" class="section level3">
<h3><span class="math inline">\(N=0.01\)</span></h3>
<pre class="r"><code>N=0.01

kable(
  benchmark(
    forloop = {for(i in 1:8){Sys.sleep(N)}},
    lapply = lapply(rep(N,8), Sys.sleep),
    mclapply = mclapply(rep(N,8), Sys.sleep), replications= 10
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">forloop</td>
<td align="right">10</td>
<td align="right">0.867</td>
<td align="right">1.419</td>
<td align="right">0.054</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">lapply</td>
<td align="right">10</td>
<td align="right">0.815</td>
<td align="right">1.334</td>
<td align="right">0.006</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">mclapply</td>
<td align="right">10</td>
<td align="right">0.611</td>
<td align="right">1.000</td>
<td align="right">0.016</td>
<td align="right">0.486</td>
<td align="right">0.077</td>
<td align="right">0.637</td>
</tr>
</tbody>
</table>
</div>
<div id="n0.1" class="section level3">
<h3><span class="math inline">\(N=0.1\)</span></h3>
<pre class="r"><code>N=0.1

kable(
  benchmark(
    forloop = {for(i in 1:8){Sys.sleep(N)}},
    lapply = lapply(rep(N,8), Sys.sleep),
    mclapply = mclapply(rep(N,8), Sys.sleep), replications= 10
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">forloop</td>
<td align="right">10</td>
<td align="right">8.086</td>
<td align="right">5.187</td>
<td align="right">0.069</td>
<td align="right">0.00</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="even">
<td align="left">lapply</td>
<td align="right">10</td>
<td align="right">8.026</td>
<td align="right">5.148</td>
<td align="right">0.007</td>
<td align="right">0.00</td>
<td align="right">0.000</td>
<td align="right">0.000</td>
</tr>
<tr class="odd">
<td align="left">mclapply</td>
<td align="right">10</td>
<td align="right">1.559</td>
<td align="right">1.000</td>
<td align="right">0.053</td>
<td align="right">0.52</td>
<td align="right">0.089</td>
<td align="right">1.271</td>
</tr>
</tbody>
</table>
</div>
<div id="n1" class="section level3">
<h3><span class="math inline">\(N=1\)</span></h3>
<pre class="r"><code>N=1

kable(
  benchmark(
    forloop = {for(i in 1:8){Sys.sleep(N)}},
    lapply = lapply(rep(N,8), Sys.sleep),
    mclapply = mclapply(rep(N,8), Sys.sleep), replications= 1
  )
)</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">test</th>
<th align="right">replications</th>
<th align="right">elapsed</th>
<th align="right">relative</th>
<th align="right">user.self</th>
<th align="right">sys.self</th>
<th align="right">user.child</th>
<th align="right">sys.child</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">forloop</td>
<td align="right">1</td>
<td align="right">8.012</td>
<td align="right">7.638</td>
<td align="right">0.003</td>
<td align="right">0.001</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
<tr class="even">
<td align="left">lapply</td>
<td align="right">1</td>
<td align="right">8.009</td>
<td align="right">7.635</td>
<td align="right">0.001</td>
<td align="right">0.000</td>
<td align="right">0.00</td>
<td align="right">0.00</td>
</tr>
<tr class="odd">
<td align="left">mclapply</td>
<td align="right">1</td>
<td align="right">1.049</td>
<td align="right">1.000</td>
<td align="right">0.000</td>
<td align="right">0.048</td>
<td align="right">0.01</td>
<td align="right">0.07</td>
</tr>
</tbody>
</table>
<p>결론적으로 작업당 0.01초 이상이 걸리면 multi-core의 강점이 드러난다고 할 수 있겠다.</p>
</div>
</div>
</div>
<div id="table-1" class="section level1 tabset">
<h1>Table 1</h1>
<p><strong>tableone</strong> 패키지를 이용하면 간단하게 논문에 들어갈 table 1을 만들 수 있다. TG <span class="math inline">\(\ge200\)</span> 을 기준으로 그룹을 나누어 table 1을 만들어보도록 하자. 편의상 몇가지 변수만 뽑아 결측치 없는 데이터를 만든 후 table 1을 만들겠다.</p>
<pre class="r"><code>#install.packages(&quot;tableone&quot;)
library(tableone)

## Make TG variable
ph[,hyperTG := as.numeric(TG&gt;=200)]

## Rename sex
ph[,sex:= ifelse(sex==0,&quot;Male&quot;,&quot;Female&quot;)]

## Rename : Sex, Age
setnames(ph, c(&quot;sex&quot;, &quot;age&quot;), c(&quot;Sex&quot;, &quot;Age&quot;))

## select var
vars.tb1 = names(ph)[c(3:20,27,28)]
vars.tb1</code></pre>
<pre><code>##  [1] &quot;Sex&quot;              &quot;Age&quot;              &quot;DXA_total_tscore&quot;
##  [4] &quot;FBS&quot;              &quot;tCholesterol&quot;     &quot;HDL&quot;             
##  [7] &quot;LDL&quot;              &quot;TG&quot;               &quot;Height&quot;          
## [10] &quot;Weight&quot;           &quot;SittingHt&quot;        &quot;Waist&quot;           
## [13] &quot;Hip&quot;              &quot;headcircum&quot;       &quot;armspan&quot;         
## [16] &quot;BMI&quot;              &quot;SBP&quot;              &quot;DBP&quot;             
## [19] &quot;smoke&quot;            &quot;alcohol&quot;</code></pre>
<pre class="r"><code>## Na omit
ph.omit = na.omit(ph, vars.tb1)</code></pre>
<div id="ctrl-c-ctrl-v" class="section level2">
<h2>Ctrl + C &amp; Ctrl + V</h2>
<p><code>CreatTableOne</code>함수로 테이블을 만든 후 <code>print</code>명령어로 세부 옵션을 지정할 수 있다. 주요 옵션은 다음과 같다.</p>
<ul>
<li><code>CreatTableOne</code>
<ul>
<li><p><strong>vars</strong>: 테이블에 들어갈 변수들</p></li>
<li><p><strong>strata</strong> : 그룹 변수(여러 개 가능)</p></li>
<li><p><strong>factorVars</strong>: 범주형 변수들</p></li>
<li><p><strong>data</strong>: 데이터</p></li>
<li><p><strong>includeNA</strong>: 범주형변수에서 <code>NA</code>를 하나의 범주로 포함할 것인가?</p></li>
</ul></li>
</ul>
<pre class="r"><code>tb1= CreateTableOne(vars = vars.tb1,
                    strata = &quot;hyperTG&quot;, 
                    factorVars = c(&quot;Sex&quot;,&quot;smoke&quot;,&quot;alcohol&quot;), 
                    data = ph.omit, 
                    includeNA = F
                    )

tb1</code></pre>
<pre><code>##                               Stratified by hyperTG
##                                0              1              p      test
##   n                              2365            321                    
##   Sex = Male (%)                  839 (35.5)     200 (62.3)  &lt;0.001     
##   Age (mean (sd))               43.74 (13.00)  47.43 (13.23) &lt;0.001     
##   DXA_total_tscore (mean (sd))  -0.32 (1.31)   -0.55 (1.27)   0.003     
##   FBS (mean (sd))               92.40 (15.93) 102.53 (28.28) &lt;0.001     
##   tCholesterol (mean (sd))     187.46 (34.64) 203.58 (37.36) &lt;0.001     
##   HDL (mean (sd))               51.22 (12.46)  41.56 (9.26)  &lt;0.001     
##   LDL (mean (sd))              110.18 (30.16) 110.90 (32.91)  0.692     
##   TG (mean (sd))                92.45 (40.55) 280.95 (91.61) &lt;0.001     
##   Height (mean (sd))           161.25 (8.44)  164.32 (8.34)  &lt;0.001     
##   Weight (mean (sd))            60.91 (10.68)  70.05 (11.96) &lt;0.001     
##   SittingHt (mean (sd))         88.00 (4.67)   89.87 (4.50)  &lt;0.001     
##   Waist (mean (sd))             79.50 (8.88)   87.35 (8.06)  &lt;0.001     
##   Hip (mean (sd))               94.12 (5.67)   97.21 (5.91)  &lt;0.001     
##   headcircum (mean (sd))        55.29 (3.52)   55.85 (1.85)   0.005     
##   armspan (mean (sd))          160.50 (9.36)  163.20 (9.40)  &lt;0.001     
##   BMI (mean (sd))               23.34 (3.15)   25.81 (3.21)  &lt;0.001     
##   SBP (mean (sd))              116.27 (16.47) 126.57 (17.26) &lt;0.001     
##   DBP (mean (sd))               73.52 (10.50)  79.27 (11.64) &lt;0.001     
##   smoke (%)                                                  &lt;0.001     
##      1                           1621 (68.5)     135 (42.1)             
##      2                            282 (11.9)      54 (16.8)             
##      3                            462 (19.5)     132 (41.1)             
##   alcohol (%)                                                 0.002     
##      1                            695 (29.4)      79 (24.6)             
##      2                            238 (10.1)      18 ( 5.6)             
##      3                           1432 (60.5)     224 (69.8)</code></pre>
<ul>
<li><code>print</code>
<ul>
<li><p><strong>nonnormal</strong>: 비모수통계를 쓸 연속 변수</p></li>
<li><p><strong>exact</strong>: fisher-test를 쓸 범주형 변수</p></li>
<li><p><strong>smd</strong>: standardized mean difference</p></li>
<li><p><strong>cramVars</strong>: 2범주인 변수에서 2범주를 다 보여줄 변수.</p></li>
</ul></li>
</ul>
<pre class="r"><code>zz= print(tb1, 
          nonnormal = c(&quot;FBS&quot;,&quot;TG&quot;), 
          exact = c(&quot;Sex&quot;, &quot;alcohol&quot;), 
          smd = TRUE, 
          cramVars = &quot;Sex&quot;, 
          printToggle=T,quote=T)</code></pre>
<pre><code>##                                 &quot;Stratified by hyperTG&quot;
##  &quot;&quot;                              &quot;0&quot;                       
##   &quot;n&quot;                            &quot;    2365&quot;                
##   &quot;Sex = Female/Male (%)&quot;        &quot;1526/839 (64.5/35.5) &quot;   
##   &quot;Age (mean (sd))&quot;              &quot;   43.74 (13.00)&quot;        
##   &quot;DXA_total_tscore (mean (sd))&quot; &quot;   -0.32 (1.31)&quot;         
##   &quot;FBS (median [IQR])&quot;           &quot;   90.00 [85.00, 96.00]&quot; 
##   &quot;tCholesterol (mean (sd))&quot;     &quot;  187.46 (34.64)&quot;        
##   &quot;HDL (mean (sd))&quot;              &quot;   51.22 (12.46)&quot;        
##   &quot;LDL (mean (sd))&quot;              &quot;  110.18 (30.16)&quot;        
##   &quot;TG (median [IQR])&quot;            &quot;   85.00 [60.00, 120.00]&quot;
##   &quot;Height (mean (sd))&quot;           &quot;  161.25 (8.44)&quot;         
##   &quot;Weight (mean (sd))&quot;           &quot;   60.91 (10.68)&quot;        
##   &quot;SittingHt (mean (sd))&quot;        &quot;   88.00 (4.67)&quot;         
##   &quot;Waist (mean (sd))&quot;            &quot;   79.50 (8.88)&quot;         
##   &quot;Hip (mean (sd))&quot;              &quot;   94.12 (5.67)&quot;         
##   &quot;headcircum (mean (sd))&quot;       &quot;   55.29 (3.52)&quot;         
##   &quot;armspan (mean (sd))&quot;          &quot;  160.50 (9.36)&quot;         
##   &quot;BMI (mean (sd))&quot;              &quot;   23.34 (3.15)&quot;         
##   &quot;SBP (mean (sd))&quot;              &quot;  116.27 (16.47)&quot;        
##   &quot;DBP (mean (sd))&quot;              &quot;   73.52 (10.50)&quot;        
##   &quot;smoke (%)&quot;                    &quot;&quot;                        
##   &quot;   1&quot;                         &quot;    1621 (68.5) &quot;        
##   &quot;   2&quot;                         &quot;     282 (11.9) &quot;        
##   &quot;   3&quot;                         &quot;     462 (19.5) &quot;        
##   &quot;alcohol (%)&quot;                  &quot;&quot;                        
##   &quot;   1&quot;                         &quot;     695 (29.4) &quot;        
##   &quot;   2&quot;                         &quot;     238 (10.1) &quot;        
##   &quot;   3&quot;                         &quot;    1432 (60.5) &quot;        
##                                 &quot;Stratified by hyperTG&quot;
##  &quot;&quot;                              &quot;1&quot;                        &quot;p&quot;     
##   &quot;n&quot;                            &quot;    321&quot;                  &quot;&quot;      
##   &quot;Sex = Female/Male (%)&quot;        &quot;121/200 (37.7/62.3) &quot;     &quot;&lt;0.001&quot;
##   &quot;Age (mean (sd))&quot;              &quot;  47.43 (13.23)&quot;          &quot;&lt;0.001&quot;
##   &quot;DXA_total_tscore (mean (sd))&quot; &quot;  -0.55 (1.27)&quot;           &quot; 0.003&quot;
##   &quot;FBS (median [IQR])&quot;           &quot;  95.00 [89.00, 106.00]&quot;  &quot;&lt;0.001&quot;
##   &quot;tCholesterol (mean (sd))&quot;     &quot; 203.58 (37.36)&quot;          &quot;&lt;0.001&quot;
##   &quot;HDL (mean (sd))&quot;              &quot;  41.56 (9.26)&quot;           &quot;&lt;0.001&quot;
##   &quot;LDL (mean (sd))&quot;              &quot; 110.90 (32.91)&quot;          &quot; 0.692&quot;
##   &quot;TG (median [IQR])&quot;            &quot; 251.00 [219.00, 311.00]&quot; &quot;&lt;0.001&quot;
##   &quot;Height (mean (sd))&quot;           &quot; 164.32 (8.34)&quot;           &quot;&lt;0.001&quot;
##   &quot;Weight (mean (sd))&quot;           &quot;  70.05 (11.96)&quot;          &quot;&lt;0.001&quot;
##   &quot;SittingHt (mean (sd))&quot;        &quot;  89.87 (4.50)&quot;           &quot;&lt;0.001&quot;
##   &quot;Waist (mean (sd))&quot;            &quot;  87.35 (8.06)&quot;           &quot;&lt;0.001&quot;
##   &quot;Hip (mean (sd))&quot;              &quot;  97.21 (5.91)&quot;           &quot;&lt;0.001&quot;
##   &quot;headcircum (mean (sd))&quot;       &quot;  55.85 (1.85)&quot;           &quot; 0.005&quot;
##   &quot;armspan (mean (sd))&quot;          &quot; 163.20 (9.40)&quot;           &quot;&lt;0.001&quot;
##   &quot;BMI (mean (sd))&quot;              &quot;  25.81 (3.21)&quot;           &quot;&lt;0.001&quot;
##   &quot;SBP (mean (sd))&quot;              &quot; 126.57 (17.26)&quot;          &quot;&lt;0.001&quot;
##   &quot;DBP (mean (sd))&quot;              &quot;  79.27 (11.64)&quot;          &quot;&lt;0.001&quot;
##   &quot;smoke (%)&quot;                    &quot;&quot;                         &quot;&lt;0.001&quot;
##   &quot;   1&quot;                         &quot;    135 (42.1) &quot;          &quot;&quot;      
##   &quot;   2&quot;                         &quot;     54 (16.8) &quot;          &quot;&quot;      
##   &quot;   3&quot;                         &quot;    132 (41.1) &quot;          &quot;&quot;      
##   &quot;alcohol (%)&quot;                  &quot;&quot;                         &quot; 0.002&quot;
##   &quot;   1&quot;                         &quot;     79 (24.6) &quot;          &quot;&quot;      
##   &quot;   2&quot;                         &quot;     18 ( 5.6) &quot;          &quot;&quot;      
##   &quot;   3&quot;                         &quot;    224 (69.8) &quot;          &quot;&quot;      
##                                 &quot;Stratified by hyperTG&quot;
##  &quot;&quot;                              &quot;test&quot;    &quot;SMD&quot;   
##   &quot;n&quot;                            &quot;&quot;        &quot;&quot;      
##   &quot;Sex = Female/Male (%)&quot;        &quot;exact&quot;   &quot; 0.557&quot;
##   &quot;Age (mean (sd))&quot;              &quot;&quot;        &quot; 0.281&quot;
##   &quot;DXA_total_tscore (mean (sd))&quot; &quot;&quot;        &quot; 0.178&quot;
##   &quot;FBS (median [IQR])&quot;           &quot;nonnorm&quot; &quot; 0.441&quot;
##   &quot;tCholesterol (mean (sd))&quot;     &quot;&quot;        &quot; 0.447&quot;
##   &quot;HDL (mean (sd))&quot;              &quot;&quot;        &quot; 0.879&quot;
##   &quot;LDL (mean (sd))&quot;              &quot;&quot;        &quot; 0.023&quot;
##   &quot;TG (median [IQR])&quot;            &quot;nonnorm&quot; &quot; 2.661&quot;
##   &quot;Height (mean (sd))&quot;           &quot;&quot;        &quot; 0.366&quot;
##   &quot;Weight (mean (sd))&quot;           &quot;&quot;        &quot; 0.806&quot;
##   &quot;SittingHt (mean (sd))&quot;        &quot;&quot;        &quot; 0.408&quot;
##   &quot;Waist (mean (sd))&quot;            &quot;&quot;        &quot; 0.926&quot;
##   &quot;Hip (mean (sd))&quot;              &quot;&quot;        &quot; 0.534&quot;
##   &quot;headcircum (mean (sd))&quot;       &quot;&quot;        &quot; 0.199&quot;
##   &quot;armspan (mean (sd))&quot;          &quot;&quot;        &quot; 0.288&quot;
##   &quot;BMI (mean (sd))&quot;              &quot;&quot;        &quot; 0.777&quot;
##   &quot;SBP (mean (sd))&quot;              &quot;&quot;        &quot; 0.610&quot;
##   &quot;DBP (mean (sd))&quot;              &quot;&quot;        &quot; 0.518&quot;
##   &quot;smoke (%)&quot;                    &quot;&quot;        &quot; 0.567&quot;
##   &quot;   1&quot;                         &quot;&quot;        &quot;&quot;      
##   &quot;   2&quot;                         &quot;&quot;        &quot;&quot;      
##   &quot;   3&quot;                         &quot;&quot;        &quot;&quot;      
##   &quot;alcohol (%)&quot;                  &quot;exact&quot;   &quot; 0.218&quot;
##   &quot;   1&quot;                         &quot;&quot;        &quot;&quot;      
##   &quot;   2&quot;                         &quot;&quot;        &quot;&quot;      
##   &quot;   3&quot;                         &quot;&quot;        &quot;&quot;</code></pre>
</div>
<div id="export-table" class="section level2">
<h2>Export table</h2>
<pre class="r"><code>kable(
  zz,
  align=&quot;c&quot;,
  caption=&quot;Descriptive statistics by TG&quot;,
  col.names=c(&quot;TG &lt; 200&quot;,&quot;TG ≥ 200&quot;,&quot;p&quot;,&quot;test&quot;,&quot;SMD&quot;)
)</code></pre>
<table>
<caption>Descriptive statistics by TG</caption>
<thead>
<tr class="header">
<th></th>
<th align="center">TG &lt; 200</th>
<th align="center">TG ≥ 200</th>
<th align="center">p</th>
<th align="center">test</th>
<th align="center">SMD</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“n”</td>
<td align="center">2365</td>
<td align="center">321</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td>“Sex = Female/Male (%)”</td>
<td align="center">1526/839 (64.5/35.5)</td>
<td align="center">121/200 (37.7/62.3)</td>
<td align="center">&lt;0.001</td>
<td align="center">exact</td>
<td align="center">0.557</td>
</tr>
<tr class="odd">
<td>“Age (mean (sd))”</td>
<td align="center">43.74 (13.00)</td>
<td align="center">47.43 (13.23)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.281</td>
</tr>
<tr class="even">
<td>“DXA_total_tscore (mean (sd))”</td>
<td align="center">-0.32 (1.31)</td>
<td align="center">-0.55 (1.27)</td>
<td align="center">0.003</td>
<td align="center"></td>
<td align="center">0.178</td>
</tr>
<tr class="odd">
<td>“FBS (median [IQR])”</td>
<td align="center">90.00 [85.00, 96.00]</td>
<td align="center">95.00 [89.00, 106.00]</td>
<td align="center">&lt;0.001</td>
<td align="center">nonnorm</td>
<td align="center">0.441</td>
</tr>
<tr class="even">
<td>“tCholesterol (mean (sd))”</td>
<td align="center">187.46 (34.64)</td>
<td align="center">203.58 (37.36)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.447</td>
</tr>
<tr class="odd">
<td>“HDL (mean (sd))”</td>
<td align="center">51.22 (12.46)</td>
<td align="center">41.56 (9.26)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.879</td>
</tr>
<tr class="even">
<td>“LDL (mean (sd))”</td>
<td align="center">110.18 (30.16)</td>
<td align="center">110.90 (32.91)</td>
<td align="center">0.692</td>
<td align="center"></td>
<td align="center">0.023</td>
</tr>
<tr class="odd">
<td>“TG (median [IQR])”</td>
<td align="center">85.00 [60.00, 120.00]</td>
<td align="center">251.00 [219.00, 311.00]</td>
<td align="center">&lt;0.001</td>
<td align="center">nonnorm</td>
<td align="center">2.661</td>
</tr>
<tr class="even">
<td>“Height (mean (sd))”</td>
<td align="center">161.25 (8.44)</td>
<td align="center">164.32 (8.34)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.366</td>
</tr>
<tr class="odd">
<td>“Weight (mean (sd))”</td>
<td align="center">60.91 (10.68)</td>
<td align="center">70.05 (11.96)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.806</td>
</tr>
<tr class="even">
<td>“SittingHt (mean (sd))”</td>
<td align="center">88.00 (4.67)</td>
<td align="center">89.87 (4.50)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.408</td>
</tr>
<tr class="odd">
<td>“Waist (mean (sd))”</td>
<td align="center">79.50 (8.88)</td>
<td align="center">87.35 (8.06)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.926</td>
</tr>
<tr class="even">
<td>“Hip (mean (sd))”</td>
<td align="center">94.12 (5.67)</td>
<td align="center">97.21 (5.91)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.534</td>
</tr>
<tr class="odd">
<td>“headcircum (mean (sd))”</td>
<td align="center">55.29 (3.52)</td>
<td align="center">55.85 (1.85)</td>
<td align="center">0.005</td>
<td align="center"></td>
<td align="center">0.199</td>
</tr>
<tr class="even">
<td>“armspan (mean (sd))”</td>
<td align="center">160.50 (9.36)</td>
<td align="center">163.20 (9.40)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.288</td>
</tr>
<tr class="odd">
<td>“BMI (mean (sd))”</td>
<td align="center">23.34 (3.15)</td>
<td align="center">25.81 (3.21)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.777</td>
</tr>
<tr class="even">
<td>“SBP (mean (sd))”</td>
<td align="center">116.27 (16.47)</td>
<td align="center">126.57 (17.26)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.610</td>
</tr>
<tr class="odd">
<td>“DBP (mean (sd))”</td>
<td align="center">73.52 (10.50)</td>
<td align="center">79.27 (11.64)</td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.518</td>
</tr>
<tr class="even">
<td>“smoke (%)”</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">&lt;0.001</td>
<td align="center"></td>
<td align="center">0.567</td>
</tr>
<tr class="odd">
<td>&quot; 1“</td>
<td align="center">1621 (68.5)</td>
<td align="center">135 (42.1)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td>&quot; 2“</td>
<td align="center">282 (11.9)</td>
<td align="center">54 (16.8)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>&quot; 3“</td>
<td align="center">462 (19.5)</td>
<td align="center">132 (41.1)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td>“alcohol (%)”</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">0.002</td>
<td align="center">exact</td>
<td align="center">0.218</td>
</tr>
<tr class="odd">
<td>&quot; 1“</td>
<td align="center">695 (29.4)</td>
<td align="center">79 (24.6)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td>&quot; 2“</td>
<td align="center">238 (10.1)</td>
<td align="center">18 ( 5.6)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>&quot; 3“</td>
<td align="center">1432 (60.5)</td>
<td align="center">224 (69.8)</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="regression-result" class="section level1 tabset">
<h1>Regression result</h1>
<p><strong>epiDisplay</strong> 패키지를 이용하면 회귀분석 결과를 보기 좋게 정리할 수 있고 adjust p-value와 crude p-value를 동시에 확인할 수 있다. 명령어는 아래의 4가지이다.</p>
<ol style="list-style-type: decimal">
<li><p><code>regress.display</code>: Linear model</p></li>
<li><p><code>logistic.display</code>: Logistic model</p></li>
<li><p><code>idr.display</code>: Poisson regression</p></li>
<li><p><code>cox.display</code>: Cox proportional hazard model</p></li>
</ol>
<div id="linear-regression" class="section level2">
<h2>Linear regression</h2>
<pre class="r"><code>## Load package
library(epiDisplay)

## Pre-setting: factor variable 
factorVars= c(&quot;Sex&quot;, &quot;smoke&quot;, &quot;alcohol&quot;)
ph[, (factorVars) := lapply(.SD, as.factor), .SDcols= factorVars]

## Linear model
m1 = lm(LDL~ Age +Sex + BMI + smoke + alcohol , data=ph)

## summary table
tb.m1 = regress.display(m1, crude=T, crude.p.value = T)
tb.m1</code></pre>
<pre><code>## Linear regression predicting LDL
##  
##                     crude coeff.(95%CI)  crude P value
## Age (cont. var.)    0.55 (0.47,0.64)     &lt; 0.001      
##                                                       
## Sex: Male vs Female 4.06 (1.72,6.4)      &lt; 0.001      
##                                                       
## BMI (cont. var.)    2.29 (1.95,2.64)     &lt; 0.001      
##                                                       
## smoke: ref.=1                                         
##    2                2.18 (-1.34,5.71)    0.225        
##    3                1.81 (-1,4.63)       0.207        
##                                                       
## alcohol: ref.=1                                       
##    2                -5.22 (-9.48,-0.95)  0.017        
##    3                -6.47 (-9.05,-3.89)  &lt; 0.001      
##                                                       
##                     adj. coeff.(95%CI)   P(t-test) P(F-test)
## Age (cont. var.)    0.43 (0.34,0.52)     &lt; 0.001   &lt; 0.001  
##                                                             
## Sex: Male vs Female 2.11 (-0.92,5.14)    0.173     0.001    
##                                                             
## BMI (cont. var.)    1.86 (1.51,2.21)     &lt; 0.001   &lt; 0.001  
##                                                             
## smoke: ref.=1                                      0.355    
##    2                -1.49 (-5.45,2.48)   0.462              
##    3                1.45 (-1.92,4.83)    0.398              
##                                                             
## alcohol: ref.=1                                    0.054    
##    2                -2.1 (-6.25,2.04)    0.32               
##    3                -3.35 (-6.08,-0.63)  0.016              
##                                                             
## No. of observations = 2728</code></pre>
<pre class="r"><code>## Export table
kable(tb.m1$table[rownames(tb.m1$table) != &quot;&quot;,], align=&quot;c&quot;, caption = tb.m1$last.lines)</code></pre>
<table>
<caption>No. of observations = 2728</caption>
<thead>
<tr class="header">
<th></th>
<th align="center">crude coeff.(95%CI)</th>
<th align="center">crude P value</th>
<th align="center">adj. coeff.(95%CI)</th>
<th align="center">P(t-test)</th>
<th align="center">P(F-test)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age (cont. var.)</td>
<td align="center">0.55 (0.47,0.64)</td>
<td align="center">&lt; 0.001</td>
<td align="center">0.43 (0.34,0.52)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td>Sex: Male vs Female</td>
<td align="center">4.06 (1.72,6.4)</td>
<td align="center">&lt; 0.001</td>
<td align="center">2.11 (-0.92,5.14)</td>
<td align="center">0.173</td>
<td align="center">0.001</td>
</tr>
<tr class="odd">
<td>BMI (cont. var.)</td>
<td align="center">2.29 (1.95,2.64)</td>
<td align="center">&lt; 0.001</td>
<td align="center">1.86 (1.51,2.21)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td>smoke: ref.=1</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">0.355</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">2.18 (-1.34,5.71)</td>
<td align="center">0.225</td>
<td align="center">-1.49 (-5.45,2.48)</td>
<td align="center">0.462</td>
<td align="center"></td>
</tr>
<tr class="even">
<td>3</td>
<td align="center">1.81 (-1,4.63)</td>
<td align="center">0.207</td>
<td align="center">1.45 (-1.92,4.83)</td>
<td align="center">0.398</td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>alcohol: ref.=1</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">0.054</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">-5.22 (-9.48,-0.95)</td>
<td align="center">0.017</td>
<td align="center">-2.1 (-6.25,2.04)</td>
<td align="center">0.32</td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>3</td>
<td align="center">-6.47 (-9.05,-3.89)</td>
<td align="center">&lt; 0.001</td>
<td align="center">-3.35 (-6.08,-0.63)</td>
<td align="center">0.016</td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div id="logistic-regression" class="section level2">
<h2>Logistic regression</h2>
<pre class="r"><code>## Logistic model
m2 = glm(hyperTG~ Age +Sex + BMI + smoke + alcohol , data=ph, family=binomial)

## summary table
tb.m2 = logistic.display(m2, crude=T, crude.p.value = T)
tb.m2</code></pre>
<pre><code>## 
## Logistic regression predicting hyperTG 
##  
##                     crude OR(95%CI)   crude P value adj. OR(95%CI)   
## Age (cont. var.)    1.02 (1.01,1.03)  &lt; 0.001       1.02 (1.01,1.03) 
##                                                                      
## Sex: Male vs Female 2.94 (2.32,3.74)  &lt; 0.001       1.58 (1.13,2.23) 
##                                                                      
## BMI (cont. var.)    1.23 (1.19,1.27)  &lt; 0.001       1.21 (1.17,1.26) 
##                                                                      
## smoke: ref.=1                                                        
##    2                2.27 (1.62,3.18)  &lt; 0.001       1.49 (0.98,2.27) 
##    3                3.34 (2.57,4.33)  &lt; 0.001       2.51 (1.76,3.59) 
##                                                                      
## alcohol: ref.=1                                                      
##    2                0.7 (0.42,1.18)   0.18          0.65 (0.37,1.14) 
##    3                1.38 (1.05,1.81)  0.02          1.11 (0.8,1.53)  
##                                                                      
##                     P(Wald&#39;s test) P(LR-test)
## Age (cont. var.)    &lt; 0.001        &lt; 0.001   
##                                              
## Sex: Male vs Female 0.008          0.008     
##                                              
## BMI (cont. var.)    &lt; 0.001        &lt; 0.001   
##                                              
## smoke: ref.=1                      &lt; 0.001   
##    2                0.064                    
##    3                &lt; 0.001                  
##                                              
## alcohol: ref.=1                    0.106     
##    2                0.131                    
##    3                0.53                     
##                                              
## Log-likelihood = -872.071
## No. of observations = 2727
## AIC value = 1760.1421</code></pre>
<pre class="r"><code>## Export table
kable(tb.m2$table[rownames(tb.m2$table) != &quot;&quot;,], align=&quot;c&quot;, caption = tb.m2$last.lines)</code></pre>
<table>
<caption>Log-likelihood = -872.071 No. of observations = 2727 AIC value = 1760.1421</caption>
<thead>
<tr class="header">
<th></th>
<th align="center">crude OR(95%CI)</th>
<th align="center">crude P value</th>
<th align="center">adj. OR(95%CI)</th>
<th align="center">P(Wald’s test)</th>
<th align="center">P(LR-test)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Age (cont. var.)</td>
<td align="center">1.02 (1.01,1.03)</td>
<td align="center">&lt; 0.001</td>
<td align="center">1.02 (1.01,1.03)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td>Sex: Male vs Female</td>
<td align="center">2.94 (2.32,3.74)</td>
<td align="center">&lt; 0.001</td>
<td align="center">1.58 (1.13,2.23)</td>
<td align="center">0.008</td>
<td align="center">0.008</td>
</tr>
<tr class="odd">
<td>BMI (cont. var.)</td>
<td align="center">1.23 (1.19,1.27)</td>
<td align="center">&lt; 0.001</td>
<td align="center">1.21 (1.17,1.26)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td>smoke: ref.=1</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="odd">
<td>2</td>
<td align="center">2.27 (1.62,3.18)</td>
<td align="center">&lt; 0.001</td>
<td align="center">1.49 (0.98,2.27)</td>
<td align="center">0.064</td>
<td align="center"></td>
</tr>
<tr class="even">
<td>3</td>
<td align="center">3.34 (2.57,4.33)</td>
<td align="center">&lt; 0.001</td>
<td align="center">2.51 (1.76,3.59)</td>
<td align="center">&lt; 0.001</td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>alcohol: ref.=1</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center">0.106</td>
</tr>
<tr class="even">
<td>2</td>
<td align="center">0.7 (0.42,1.18)</td>
<td align="center">0.18</td>
<td align="center">0.65 (0.37,1.14)</td>
<td align="center">0.131</td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>3</td>
<td align="center">1.38 (1.05,1.81)</td>
<td align="center">0.02</td>
<td align="center">1.11 (0.8,1.53)</td>
<td align="center">0.53</td>
<td align="center"></td>
</tr>
</tbody>
</table>
</div>
<div id="poisson-regression--" class="section level2">
<h2>Poisson regression: 사망 데이터</h2>
<pre class="r"><code>## Load example data
library(HEAT);data(mort)

## Poisson regression
m3 = glm(nonacc~meantemp+ meanso2 + meanhumi, data= mort, family= poisson)

## Summary table
tb.m3 = idr.display(m3, crude=T, crude.p.value = T )</code></pre>
<pre class="r"><code>tb.m3</code></pre>
<pre><code>## 
## Poisson regression predicting nonacc 
##  
##                       crude IDR(95%CI)        crude P value
## meantemp (cont. var.) 0.9934 (0.9932,0.9937)  &lt; 0.001      
##                                                            
## meanso2 (cont. var.)  1.02 (1.02,1.02)        &lt; 0.001      
##                                                            
## meanhumi (cont. var.) 0.9942 (0.9941,0.9944)  &lt; 0.001      
##                                                            
##                       adj. IDR(95%CI)         P(Wald&#39;s test) P(LR-test)
## meantemp (cont. var.) 0.9978 (0.9975,0.9981)  &lt; 0.001        &lt; 0.001   
##                                                                        
## meanso2 (cont. var.)  1.0079 (1.007,1.0089)   &lt; 0.001        &lt; 0.001   
##                                                                        
## meanhumi (cont. var.) 0.9952 (0.995,0.9953)   &lt; 0.001        &lt; 0.001   
##                                                                        
## Log-likelihood = -206421.7862
## No. of observations = 17361
## AIC value = 412851.5724</code></pre>
<pre class="r"><code>## Export table
kable(tb.m3$table[rownames(tb.m3$table) != &quot;&quot;,], align=&quot;c&quot;, caption = tb.m3$last.lines)</code></pre>
<table>
<caption>Log-likelihood = -206421.7862 No. of observations = 17361 AIC value = 412851.5724</caption>
<thead>
<tr class="header">
<th></th>
<th align="center">crude IDR(95%CI)</th>
<th align="center">crude P value</th>
<th align="center">adj. IDR(95%CI)</th>
<th align="center">P(Wald’s test)</th>
<th align="center">P(LR-test)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>meantemp (cont. var.)</td>
<td align="center">0.9934 (0.9932,0.9937)</td>
<td align="center">&lt; 0.001</td>
<td align="center">0.9978 (0.9975,0.9981)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="even">
<td>meanso2 (cont. var.)</td>
<td align="center">1.02 (1.02,1.02)</td>
<td align="center">&lt; 0.001</td>
<td align="center">1.0079 (1.007,1.0089)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
<tr class="odd">
<td>meanhumi (cont. var.)</td>
<td align="center">0.9942 (0.9941,0.9944)</td>
<td align="center">&lt; 0.001</td>
<td align="center">0.9952 (0.995,0.9953)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
</tbody>
</table>
</div>
<div id="cox-" class="section level2">
<h2>Cox: 생존분석</h2>
<pre class="r"><code>## Load package &amp; example data
library(survival)
data(bladder)

## Cox model
m4 = coxph(Surv(stop, event) ~ rx + size + number, data=bladder)

## Summary table
tb.m4 = cox.display(m4, crude=T, crude.p.value = T )</code></pre>
<pre class="r"><code>tb.m4</code></pre>
<pre><code>## Cox&#39;s proportional hazard model on time (&#39;stop&#39;) to event (&#39;event&#39;) 
##  
##                     crude HR(95%CI)   crude P value adj. HR(95%CI)   
## rx (cont. var.)     0.64 (0.44,0.94)  0.024         0.58 (0.39,0.86) 
##                                                                      
## size (cont. var.)   0.91 (0.79,1.04)  0.182         0.95 (0.83,1.08) 
##                                                                      
## number (cont. var.) 1.2 (1.1,1.31)    &lt; 0.001       1.21 (1.11,1.33) 
##                                                                      
##                     P(Wald&#39;s test) P(LR-test)
## rx (cont. var.)     0.007          0.006     
##                                              
## size (cont. var.)   0.43           0.421     
##                                              
## number (cont. var.) &lt; 0.001        &lt; 0.001   
##                                              
## No. of observations =  340</code></pre>
<pre class="r"><code>## Export table
kable(tb.m4$table[rownames(tb.m4$table) != &quot;&quot;,], align=&quot;c&quot;, caption = tb.m4$last.lines)</code></pre>
<table>
<caption>No. of observations = 340</caption>
<thead>
<tr class="header">
<th></th>
<th align="center">crude HR(95%CI)</th>
<th align="center">crude P value</th>
<th align="center">adj. HR(95%CI)</th>
<th align="center">P(Wald’s test)</th>
<th align="center">P(LR-test)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>rx (cont. var.)</td>
<td align="center">0.64 (0.44,0.94)</td>
<td align="center">0.024</td>
<td align="center">0.58 (0.39,0.86)</td>
<td align="center">0.007</td>
<td align="center">0.006</td>
</tr>
<tr class="even">
<td>size (cont. var.)</td>
<td align="center">0.91 (0.79,1.04)</td>
<td align="center">0.182</td>
<td align="center">0.95 (0.83,1.08)</td>
<td align="center">0.43</td>
<td align="center">0.421</td>
</tr>
<tr class="odd">
<td>number (cont. var.)</td>
<td align="center">1.2 (1.1,1.31)</td>
<td align="center">&lt; 0.001</td>
<td align="center">1.21 (1.11,1.33)</td>
<td align="center">&lt; 0.001</td>
<td align="center">&lt; 0.001</td>
</tr>
</tbody>
</table>
</div>
</div>

<p>Copyright &copy;2016 <a href="mailto:secondmath85@gmail.com">Jinseob Kim</a>&nbsp;&nbsp;

<a href="https://www.facebook.com/secondmath"><i class="fa fa-facebook fa-lg" aria-hidden="true"></i> </a> &nbsp;

<a href="https://www.linkedin.com/in/jinseob-kim-%EA%B9%80%EC%A7%84%EC%84%AD-456550a5?trk=hp-identity-name"><i class="fa fa-linkedin fa-lg" aria-hidden="true"></i></a>&nbsp;

<a href="https://github.com/mathemedicine/mathemedicine.github.io"><i class="fa fa-github fa-lg" aria-hidden="true"></i></a>

</p>




<div id="disqus_thread"></div>
<script>/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//https-jinseob2kim-github-io.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
